!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Chessground=e()}}((function(){return function e(t,n,r){function s(o,a){if(!n[o]){if(!t[o]){var c="function"==typeof require&&require;if(!a&&c)return c(o,!0);if(i)return i(o,!0);var p=new Error("Cannot find module '"+o+"'");throw p.code="MODULE_NOT_FOUND",p}var d=n[o]={exports:{}};t[o][0].call(d.exports,(function(e){return s(t[o][1][e]||e)}),d,d.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.render=n.anim=void 0;const r=e("./util");function s(e,t){const n=e(t);return t.dom.redraw(),n}function i(e,t){return{key:e,pos:r.key2pos(e),piece:t}}function o(e,t){return t.sort(((t,n)=>r.distanceSq(e.pos,t.pos)-r.distanceSq(e.pos,n.pos)))[0]}function a(e,t){const n=e.animation.current;if(void 0===n)return void(e.dom.destroyed||e.dom.redrawNow());const r=1-(t-n.start)*n.frequency;if(r<=0)e.animation.current=void 0,e.dom.redrawNow();else{const t=(s=r)<.5?4*s*s*s:(s-1)*(2*s-2)*(2*s-2)+1;for(const e of n.plan.anims.values())e[2]=e[0]*t,e[3]=e[1]*t;e.dom.redrawNow(!0),requestAnimationFrame(((t=performance.now())=>a(e,t)))}var s}n.anim=function(e,t){return t.animation.enabled?function(e,t){const n=new Map(t.pieces),s=e(t),c=function(e,t){const n=new Map,s=[],a=new Map,c=[],p=[],d=new Map;let l,u,f;for(const[r,o]of e)d.set(r,i(r,o));for(const o of r.allKeys(t.dimensions))l=t.pieces.get(o),u=d.get(o),l?u?r.samePiece(l,u.piece)||(c.push(u),p.push(i(o,l))):p.push(i(o,l)):u&&c.push(u);for(const i of p)u=o(i,c.filter((e=>r.samePiece(i.piece,e.piece)))),u&&(f=[u.pos[0]-i.pos[0],u.pos[1]-i.pos[1]],n.set(i.key,f.concat(f)),s.push(u.key));for(const r of c)s.includes(r.key)||a.set(r.key,r.piece);return{anims:n,fadings:a}}(n,t);if(c.anims.size||c.fadings.size){const e=t.animation.current&&t.animation.current.start;t.animation.current={start:performance.now(),frequency:1/t.animation.duration,plan:c},e||a(t,performance.now())}else t.dom.redraw();return s}(e,t):s(e,t)},n.render=s},{"./util":20}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.start=void 0;const r=e("./board"),s=e("./fen"),i=e("./config"),o=e("./anim"),a=e("./drag"),c=e("./explosion");n.start=function(e,t){return{set(n){var s;n.orientation&&n.orientation!==e.orientation&&(s=n.orientation,r.setOrientation(e,s),t()),(n.fen?o.anim:o.render)((e=>(0,i.configure)(e,n)),e)},state:e,getFen:()=>(0,s.write)(e.pieces,e.dimensions,e.variant),toggleOrientation:function(){r.toggleOrientation(e),t()},setPieces(t){(0,o.anim)((e=>r.setPieces(e,t)),e)},selectSquare(t,n){t?(0,o.anim)((e=>r.selectSquare(e,t,n)),e):e.selected&&(r.unselect(e),e.dom.redraw())},move(t,n){(0,o.anim)((e=>r.baseMove(e,t,n)),e)},newPiece(t,n){(0,o.anim)((e=>r.baseNewPiece(e,t,n)),e)},playPremove(){if(e.premovable.current){if((0,o.anim)(r.playPremove,e))return!0;e.dom.redraw()}return!1},playPredrop(t){if(e.predroppable.current){const n=r.playPredrop(e,t);return e.dom.redraw(),n}return!1},cancelPremove(){(0,o.render)(r.unsetPremove,e)},cancelPredrop(){(0,o.render)(r.unsetPredrop,e)},cancelMove(){(0,o.render)((e=>{r.cancelMove(e),(0,a.cancel)(e)}),e)},stop(){(0,o.render)((e=>{r.stop(e),(0,a.cancel)(e)}),e)},explode(t){(0,c.default)(e,t)},setAutoShapes(t){(0,o.render)((e=>e.drawable.autoShapes=t),e)},setShapes(t){(0,o.render)((e=>e.drawable.shapes=t),e)},getKeyAtDomPos:t=>r.getKeyAtDomPos(t,e.orientation,e.dom.bounds(),e.dimensions),redrawAll:t,dragNewPiece(t,n,r){(0,a.dragNewPiece)(e,t,n,r)},destroy(){r.stop(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}},{"./anim":1,"./board":3,"./config":5,"./drag":6,"./explosion":10,"./fen":11}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getSnappedKeyAtDomPos=n.p1Pov=n.getKeyAtDomPos=n.stop=n.cancelMove=n.playPredrop=n.playPremove=n.isDraggable=n.isPredroppable=n.canMove=n.unselect=n.setSelected=n.selectSquare=n.dropNewPiece=n.userMove=n.baseNewPiece=n.baseMove=n.unsetPredrop=n.unsetPremove=n.setPieces=n.reset=n.toggleOrientation=n.setOrientation=void 0;const r=e("./util"),s=e("./premove"),i=e("./predrop"),o=e("./transformations");function a(e,t){e.orientation=t,e.animation.current=e.draggable.current=e.selected=void 0}function c(e){e.premovable.current&&(e.premovable.current=void 0,(0,r.callUserFunction)(e.premovable.events.unset))}function p(e){const t=e.predroppable;t.current&&(t.current=void 0,(0,r.callUserFunction)(t.events.unset))}function d(e,t,n){const s=e.pieces.get(t),i=e.pieces.get(n);if(t===n||!s)return!1;const o=i&&i.playerIndex!==s.playerIndex?i:void 0;return n===e.selected&&b(e),(0,r.callUserFunction)(e.events.move,t,n,o),function(e,t,n){if(!e.autoCastle)return!1;const s=e.pieces.get(t);if(!s||"k-piece"!==s.role)return!1;const i=(0,r.key2pos)(t),o=(0,r.key2pos)(n);if(1!==i[1]&&8!==i[1]||i[1]!==o[1])return!1;5!==i[0]||e.pieces.has(n)||(7===o[0]?n=(0,r.pos2key)([8,o[1]]):3===o[0]&&(n=(0,r.pos2key)([1,o[1]])));const a=e.pieces.get(n);return!(!a||a.playerIndex!==s.playerIndex||"r-piece"!==a.role||(e.pieces.delete(t),e.pieces.delete(n),i[0]<o[0]?(e.pieces.set((0,r.pos2key)([7,o[1]]),s),e.pieces.set((0,r.pos2key)([6,o[1]]),a)):(e.pieces.set((0,r.pos2key)([3,o[1]]),s),e.pieces.set((0,r.pos2key)([4,o[1]]),a)),0))}(e,t,n)||(e.pieces.set(n,s),e.pieces.delete(t)),e.lastMove=[t,n],e.check=void 0,(0,r.callUserFunction)(e.events.change),o||!0}function l(e,t,n,s){if(e.pieces.has(n)){if(!s)return!1;e.pieces.delete(n)}return(0,r.callUserFunction)(e.events.dropNewPiece,t,n),e.pieces.set(n,t),e.lastMove=[n],e.check=void 0,(0,r.callUserFunction)(e.events.change),e.movable.dests=void 0,e.dropmode.dropDests=void 0,e.turnPlayerIndex=(0,r.opposite)(e.turnPlayerIndex),!0}function u(e,t,n){const s=d(e,t,n);return s&&(e.movable.dests=void 0,e.dropmode.dropDests=void 0,e.turnPlayerIndex=(0,r.opposite)(e.turnPlayerIndex),e.animation.current=void 0),s}function f(e,t,n){if(m(e,t,n)){const s=u(e,t,n);if(s){const i=e.hold.stop();b(e);const o={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:i};return!0!==s&&(o.captured=s),(0,r.callUserFunction)(e.movable.events.after,t,n,o),!0}}else if(function(e,t,n){return t!==n&&v(e,t)&&(0,r.containsX)((0,s.premove)(e.pieces,t,e.premovable.castle,e.dimensions,e.variant,e.chess960),n)}(e,t,n))return function(e,t,n,s){p(e),e.premovable.current=[t,n],(0,r.callUserFunction)(e.premovable.events.set,t,n,s)}(e,t,n,{ctrlKey:e.stats.ctrlKey}),b(e),!0;return b(e),!1}function h(e,t){e.selected=t,v(e,t)?e.premovable.dests=(0,s.premove)(e.pieces,t,e.premovable.castle,e.dimensions,e.variant,e.chess960):(e.premovable.dests=void 0,e.predroppable.dropDests=void 0)}function b(e){e.selected=void 0,e.premovable.dests=void 0,e.predroppable.dropDests=void 0,e.hold.cancel()}function g(e,t){const n=e.pieces.get(t);return!!n&&(!e.onlyDropsVariant||e.onlyDropsVariant&&"a0"===t)&&("both"===e.movable.playerIndex||e.movable.playerIndex===n.playerIndex&&e.turnPlayerIndex===n.playerIndex)}function m(e,t,n){var r,s;return t!==n&&g(e,t)&&(e.movable.free||!!(null===(s=null===(r=e.movable.dests)||void 0===r?void 0:r.get(t))||void 0===s?void 0:s.includes(n)))}function v(e,t){const n=e.pieces.get(t);return!!n&&e.premovable.enabled&&e.movable.playerIndex===n.playerIndex&&e.turnPlayerIndex!==n.playerIndex}function k(e){c(e),p(e),b(e)}n.setOrientation=a,n.toggleOrientation=function(e){a(e,(0,r.oppositeOrientation)(e.orientation))},n.reset=function(e){e.lastMove=void 0,b(e),c(e),p(e)},n.setPieces=function(e,t){for(const[n,r]of t)r?e.pieces.set(n,r):e.pieces.delete(n)},n.unsetPremove=c,n.unsetPredrop=p,n.baseMove=d,n.baseNewPiece=l,n.userMove=f,n.dropNewPiece=function(e,t,n,s){const o=e.pieces.get(t);var a,d;o&&(function(e,t,n){const r=e.pieces.get(t);return!(!r||t!==n&&e.pieces.has(n)||"both"!==e.movable.playerIndex&&(e.movable.playerIndex!==r.playerIndex||e.turnPlayerIndex!==r.playerIndex))}(e,t,n)||s)?(e.pieces.delete(t),l(e,o,n,s),(0,r.callUserFunction)(e.movable.events.afterNewPiece,o.role,n,{premove:!1,predrop:!1})):o&&function(e,t,n){const s=e.pieces.get(t),o=e.pieces.get(n);if(!s)return!1;const a=(0,r.containsX)((0,i.default)(e.pieces,s,e.dimensions,e.variant),n);return(!o||o.playerIndex!==e.movable.playerIndex)&&e.predroppable.enabled&&a&&e.movable.playerIndex===s.playerIndex&&e.turnPlayerIndex!==s.playerIndex}(e,t,n)?function(e,t,n){c(e),e.predroppable.current={role:t,key:n},(0,r.callUserFunction)(e.predroppable.events.set,t,n)}(e,o.role,n):(c(e),p(e),(a=e).dropmode.active=!1,(0,r.callUserFunction)(null===(d=a.dropmode.events)||void 0===d?void 0:d.cancel)),e.pieces.delete(t),b(e)},n.selectSquare=function(e,t,n){if((0,r.callUserFunction)(e.events.select,t),e.selected){if(e.selected===t&&!e.draggable.enabled)return b(e),void e.hold.cancel();if((e.selectable.enabled||n)&&e.selected!==t&&f(e,e.selected,t))return void(e.stats.dragged=!1)}(g(e,t)||v(e,t))&&(h(e,t),e.hold.start())},n.setSelected=h,n.unselect=b,n.canMove=m,n.isPredroppable=function(e){var t,n;const r=e.dropmode.active?e.dropmode.piece:null===(t=e.draggable.current)||void 0===t?void 0:t.piece;return!!r&&(e.dropmode.active||"a0"===(null===(n=e.draggable.current)||void 0===n?void 0:n.orig))&&e.predroppable.enabled&&e.movable.playerIndex===r.playerIndex&&e.turnPlayerIndex!==r.playerIndex},n.isDraggable=function(e,t){const n=e.pieces.get(t);return!!n&&e.draggable.enabled&&("both"===e.movable.playerIndex||e.movable.playerIndex===n.playerIndex&&(e.turnPlayerIndex===n.playerIndex||e.premovable.enabled))},n.playPremove=function(e){const t=e.premovable.current;if(!t)return!1;const n=t[0],s=t[1];let i=!1;if(m(e,n,s)){const t=u(e,n,s);if(t){const o={premove:!0};!0!==t&&(o.captured=t),(0,r.callUserFunction)(e.movable.events.after,n,s,o),i=!0}}return c(e),i},n.playPredrop=function(e,t){const n=e.predroppable.current;let s=!1;if(!n)return!1;if(t(n)){l(e,{role:n.role,playerIndex:e.movable.playerIndex},n.key)&&((0,r.callUserFunction)(e.movable.events.afterNewPiece,n.role,n.key,{premove:!1,predrop:!0}),s=!0)}return p(e),s},n.cancelMove=k,n.stop=function(e){e.movable.playerIndex=e.movable.dests=e.dropmode.dropDests=e.animation.current=void 0,k(e)},n.getKeyAtDomPos=function(e,t,n,s){return e=[Math.ceil(s.width*((e[0]-n.left)/n.width)),Math.ceil(s.height-s.height*((e[1]-n.top)/n.height))],(e=o.mapToP1[t](e,s))[0]>0&&e[0]<s.width+1&&e[1]>0&&e[1]<s.height+1?(0,r.pos2key)(e):void 0},n.p1Pov=function(e){return"p1"===e.myPlayerIndex},n.getSnappedKeyAtDomPos=function(e,t,n,i,o){const a=(0,r.key2pos)(e),c=(0,r.allPos)(o).filter((e=>(0,s.queen)(a[0],a[1],e[0],e[1])||(0,s.knight)(a[0],a[1],e[0],e[1]))),p=c.map((e=>(0,r.computeSquareCenter)((0,r.pos2key)(e),n,i,o))).map((e=>(0,r.distanceSq)(t,e))),[,d]=p.reduce(((e,t,n)=>e[0]<t?e:[t,n]),[p[0],0]);return(0,r.pos2key)(c[d])}},{"./predrop":13,"./premove":14,"./transformations":18,"./util":20}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Chessground=void 0;const r=e("./api"),s=e("./config"),i=e("./state"),o=e("./wrap"),a=e("./events"),c=e("./render"),p=e("./svg"),d=e("./util");function l(e){let t=!1;return()=>{t||(t=!0,requestAnimationFrame((()=>{e(),t=!1})))}}n.Chessground=function(e,t){const n=(0,i.defaults)();function u(){const t="dom"in n?n.dom.unbind:void 0,r=n.viewOnly&&!n.drawable.visible,s=(0,o.renderWrap)(e,n,r),i=d.memo((()=>s.board.getBoundingClientRect())),u=e=>{(0,c.render)(h),!e&&s.svg&&p.renderSvg(h,s.svg,s.customSvg)},f=()=>{i.clear(),(0,c.updateBounds)(h),s.svg&&p.renderSvg(h,s.svg,s.customSvg)},h=n;return h.dom={elements:s,bounds:i,redraw:l(u),redrawNow:u,unbind:t,relative:r},h.drawable.prevSvgHash="",u(!1),a.bindBoard(h,f),t||(h.dom.unbind=a.bindDocument(h,f)),h.events.insert&&h.events.insert(s),h}return(0,s.configure)(n,t||{}),(0,r.start)(u(),u)}},{"./api":2,"./config":5,"./events":9,"./render":15,"./state":16,"./svg":17,"./util":20,"./wrap":21}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.configure=void 0;const r=e("./board"),s=e("./fen");function i(e,t){for(const n in t)o(e[n])&&o(t[n])?i(e[n],t[n]):e[n]=t[n]}function o(e){return"object"==typeof e}n.configure=function(e,t){var n,o;if(t.movable&&t.movable.dests&&(e.movable.dests=void 0),(null===(n=t.dropmode)||void 0===n?void 0:n.dropDests)&&(e.dropmode.dropDests=void 0),(null===(o=t.drawable)||void 0===o?void 0:o.autoShapes)&&(e.drawable.autoShapes=[]),i(e,t),t.dimensions&&(e.dimensions=t.dimensions),t.fen){const n=(0,s.read)(t.fen,e.dimensions,e.variant);void 0!==e.pieces.get("a0")&&n.set("a0",e.pieces.get("a0")),e.pieces=n,e.drawable.shapes=[]}if("check"in t&&function(e,t){e.check=void 0,!0===t&&(t=e.turnPlayerIndex);if(t)for(const[n,r]of e.pieces)"k-piece"===r.role&&r.playerIndex===t&&(e.check=n)}(e,t.check||!1),"lastMove"in t&&!t.lastMove?e.lastMove=void 0:t.lastMove&&(e.lastMove=t.lastMove),e.selected&&(0,r.setSelected)(e,e.selected),(!e.animation.duration||e.animation.duration<100)&&(e.animation.enabled=!1),!e.movable.rookCastle&&e.movable.dests){const t="p1"===e.movable.playerIndex?1:8,n="e"+t,r=e.movable.dests.get(n),s=e.pieces.get(n);if(!r||!s||"k-piece"!==s.role)return;e.movable.dests.set(n,r.filter((e=>!(e==="a"+t&&r.includes("c"+t)||e==="h"+t&&r.includes("g"+t)))))}}},{"./board":3,"./fen":11}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.cancel=n.end=n.move=n.dragNewPiece=n.start=void 0;const r=e("./board"),s=e("./util"),i=e("./draw"),o=e("./anim"),a=e("./predrop"),c=e("./transformations");function p(e){requestAnimationFrame((()=>{var t;const n=e.draggable.current;if(!n)return;(null===(t=e.animation.current)||void 0===t?void 0:t.plan.anims.has(n.orig))&&(e.animation.current=void 0);const r=e.pieces.get(n.orig);if(r&&s.samePiece(r,n.piece)){if(!n.started&&s.distanceSq(n.epos,n.rel)>=Math.pow(e.draggable.distance,2)&&(n.started=!0),n.started){if("function"==typeof n.element){const e=n.element();if(!e)return;e.cgDragging=!0,e.classList.add("dragging"),n.element=e}n.pos=[n.epos[0]-n.rel[0],n.epos[1]-n.rel[1]];const t=s.posToTranslateAbs(e.dom.bounds(),e.dimensions)(n.origPos,e.orientation);t[0]+=n.pos[0]+n.dec[0],t[1]+=n.pos[1]+n.dec[1],s.translateAbs(n.element,t)}}else d(e);p(e)}))}function d(e){const t=e.draggable.current;t&&(t.newPiece&&e.pieces.delete(t.orig),e.draggable.current=void 0,r.unselect(e),l(e),e.dom.redraw())}function l(e){const t=e.dom.elements;t.ghost&&s.setVisible(t.ghost,!1)}function u(e,t,n,r){const i=c.mapToP1Inverse[r](s.key2pos(e),n);return{left:t.left+t.width*(i[0]-1)/n.width,top:t.top+t.height*(n.height-i[1])/n.height,width:t.width/n.width,height:t.height/n.height}}function f(e,t){let n=e.dom.elements.board.firstChild;for(;n;){if(n.cgKey===t&&"PIECE"===n.tagName)return n;n=n.nextSibling}}n.start=function(e,t){if(!t.isTrusted||void 0!==t.button&&0!==t.button)return;if(t.touches&&t.touches.length>1)return;const n=e.dom.bounds(),a=s.eventPosition(t),c=r.getKeyAtDomPos(a,e.orientation,n,e.dimensions);if(!c)return;const d=e.pieces.get(c),l=e.selected;l||!e.drawable.enabled||!e.drawable.eraseOnClick&&d&&d.playerIndex===e.turnPlayerIndex||(0,i.clear)(e),!1===t.cancelable||t.touches&&e.movable.playerIndex&&!d&&!l&&!function(e,t){const n=e.orientation,r=e.dom.bounds(),i=Math.pow(r.width/8,2);for(const o in e.pieces){const a=u(o,r,e.dimensions,n),c=[a.left+a.width/2,a.top+a.height/2];if(s.distanceSq(c,t)<=i)return!0}return!1}(e,a)||t.preventDefault();const h=!!e.premovable.current,b=!!e.predroppable.current;e.stats.ctrlKey=t.ctrlKey,e.selected&&r.canMove(e,e.selected,c)?(0,o.anim)((e=>r.selectSquare(e,c)),e):r.selectSquare(e,c);const g=e.selected===c,m=f(e,c);if(d&&m&&g&&r.isDraggable(e,c)){const r=u(c,n,e.dimensions,e.orientation);e.draggable.current={orig:c,origPos:s.key2pos(c),piece:d,rel:a,epos:a,pos:[0,0],dec:e.draggable.centerPiece?[a[0]-(r.left+r.width/2),a[1]-(r.top+r.height/2)]:[0,0],started:e.draggable.autoDistance&&e.stats.dragged,element:m,previouslySelected:l,originTarget:t.target},m.cgDragging=!0,m.classList.add("dragging");const i=e.dom.elements.ghost;if(i){const t=d.promoted?"promoted ":"",r=d.playerIndex===e.myPlayerIndex?"ally":"enemy";i.className=`ghost ${d.playerIndex} ${t}${d.role} ${r}`,s.translateAbs(i,s.posToTranslateAbs(n,e.dimensions)(s.key2pos(c),e.orientation)),s.setVisible(i,!0)}p(e)}else h&&r.unsetPremove(e),b&&r.unsetPredrop(e);e.dom.redraw()},n.dragNewPiece=function(e,t,n,i){const o="a0";e.pieces.set(o,t),e.dom.redraw();const c=s.eventPosition(n),d=r.p1Pov(e),l=e.dom.bounds(),h=u(o,l,e.dimensions,e.orientation),b=[(d?0:e.dimensions.width-1)*h.width+l.left,(d?e.dimensions.height:-1)*h.height+l.top];e.draggable.current={orig:o,origPos:s.key2pos("a0"),piece:t,rel:b,epos:c,pos:[c[0]-b[0],c[1]-b[1]],dec:[-h.width/2,-h.height/2],started:!0,element:()=>f(e,o),originTarget:n.target,newPiece:!0,force:!!i},t&&r.isPredroppable(e)&&(e.predroppable.dropDests=(0,a.default)(e.pieces,t,e.dimensions,e.variant)),p(e)},n.move=function(e,t){e.draggable.current&&(!t.touches||t.touches.length<2)&&(e.draggable.current.epos=s.eventPosition(t))},n.end=function(e,t){const n=e.draggable.current;if(!n)return;if("touchend"===t.type&&!1!==t.cancelable&&t.preventDefault(),"touchend"===t.type&&n&&n.originTarget!==t.target&&!n.newPiece)return void(e.draggable.current=void 0);r.unsetPremove(e),r.unsetPredrop(e);const i=s.eventPosition(t)||n.epos,o=r.getKeyAtDomPos(i,e.orientation,e.dom.bounds(),e.dimensions);o&&n.started&&n.orig!==o?n.newPiece?r.dropNewPiece(e,n.orig,o,n.force):(e.stats.ctrlKey=t.ctrlKey,r.userMove(e,n.orig,o)&&(e.stats.dragged=!0)):n.newPiece?e.pieces.delete(n.orig):e.draggable.deleteOnDropOff&&!o&&(e.pieces.delete(n.orig),s.callUserFunction(e.events.change)),(!n||n.orig!==n.previouslySelected||n.orig!==o&&o)&&e.selectable.enabled||r.unselect(e),l(e),e.draggable.current=void 0,e.dom.redraw()},n.cancel=d},{"./anim":1,"./board":3,"./draw":7,"./predrop":13,"./transformations":18,"./util":20}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.clear=n.cancel=n.end=n.move=n.processDraw=n.start=void 0;const r=e("./board"),s=e("./util"),i=["green","red","blue","yellow"];function o(e){requestAnimationFrame((()=>{const t=e.drawable.current;if(t){const n=(0,r.getKeyAtDomPos)(t.pos,e.orientation,e.dom.bounds(),e.dimensions);n||(t.snapToValidMove=!1);const s=t.snapToValidMove?(0,r.getSnappedKeyAtDomPos)(t.orig,t.pos,e.orientation,e.dom.bounds(),e.dimensions):n;s!==t.mouseSq&&(t.mouseSq=s,t.dest=s!==t.orig?s:void 0,e.dom.redrawNow()),o(e)}}))}function a(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function c(e){var t;const n=(e.shiftKey||e.ctrlKey)&&(0,s.isRightButton)(e),r=e.altKey||e.metaKey||(null===(t=e.getModifierState)||void 0===t?void 0:t.call(e,"AltGraph"));return i[(n?1:0)+(r?2:0)]}function p(e){e.onChange&&e.onChange(e.shapes)}n.start=function(e,t){if(t.touches&&t.touches.length>1)return;t.stopPropagation(),t.preventDefault(),t.ctrlKey?(0,r.unselect)(e):(0,r.cancelMove)(e);const n=(0,s.eventPosition)(t),i=(0,r.getKeyAtDomPos)(n,e.orientation,e.dom.bounds(),e.dimensions);i&&(e.drawable.current={orig:i,pos:n,brush:c(t),snapToValidMove:e.drawable.defaultSnapToValidMove},o(e))},n.processDraw=o,n.move=function(e,t){e.drawable.current&&(e.drawable.current.pos=(0,s.eventPosition)(t))},n.end=function(e){const t=e.drawable.current;t&&(t.mouseSq&&function(e,t){const n=e=>e.orig===t.orig&&e.dest===t.dest,r=e.shapes.filter(n)[0];r&&(e.shapes=e.shapes.filter((e=>!n(e))));r&&r.brush===t.brush||e.shapes.push(t);p(e)}(e.drawable,t),a(e))},n.cancel=a,n.clear=function(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),p(e.drawable))}},{"./board":3,"./util":20}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.drop=n.cancelDropMode=n.setDropMode=void 0;const r=e("./board"),s=e("./util"),i=e("./drag"),o=e("./predrop");n.setDropMode=function(e,t){e.dropmode.active=!0,e.dropmode.piece=t,(0,i.cancel)(e),r.unselect(e),t&&r.isPredroppable(e)&&(e.predroppable.dropDests=(0,o.default)(e.pieces,t,e.dimensions,e.variant))},n.cancelDropMode=function(e){var t;e.dropmode.active=!1,s.callUserFunction(null===(t=e.dropmode.events)||void 0===t?void 0:t.cancel)},n.drop=function(e,t){if(!e.dropmode.active)return;r.unsetPremove(e),r.unsetPredrop(e);const n=e.dropmode.piece;if(n){e.pieces.set("a0",n);const i=s.eventPosition(t),o=i&&r.getKeyAtDomPos(i,e.orientation,e.dom.bounds(),e.dimensions);o&&r.dropNewPiece(e,"a0",o)}e.dom.redraw()}},{"./board":3,"./drag":6,"./predrop":13,"./util":20}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.bindDocument=n.bindBoard=void 0;const r=e("./drag"),s=e("./draw"),i=e("./drop"),o=e("./util"),a=e("./board");function c(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function p(e,t,n){return r=>{e.drawable.current?e.drawable.enabled&&n(e,r):e.viewOnly||t(e,r)}}function d(e,t){const n=(0,o.eventPosition)(t),r=n&&(0,a.getKeyAtDomPos)(n,e.orientation,e.dom.bounds(),e.dimensions);if(r&&e.pieces.get(r))return e.pieces.get(r)}n.bindBoard=function(e,t){const n=e.dom.elements.board;if(!e.dom.relative&&e.resizable&&"ResizeObserver"in window){new window.ResizeObserver(t).observe(n)}if(e.viewOnly)return;const a=function(e){return t=>{var n;e.draggable.current?r.cancel(e):e.drawable.current?s.cancel(e):t.shiftKey||(0,o.isRightButton)(t)?e.drawable.enabled&&s.start(e,t):e.viewOnly||(e.dropmode.active&&void 0===d(e,t)||e.dropmode.active&&e.movable.playerIndex!==e.turnPlayerIndex&&(null===(n=d(e,t))||void 0===n?void 0:n.playerIndex)===e.turnPlayerIndex&&!e.onlyDropsVariant?(0,i.drop)(e,t):(e.onlyDropsVariant||(0,i.cancelDropMode)(e),r.start(e,t)))}}(e);n.addEventListener("touchstart",a,{passive:!1}),n.addEventListener("mousedown",a,{passive:!1}),(e.disableContextMenu||e.drawable.enabled)&&n.addEventListener("contextmenu",(e=>e.preventDefault()))},n.bindDocument=function(e,t){const n=[];if(e.dom.relative||!e.resizable||"ResizeObserver"in window||n.push(c(document.body,"chessground.resize",t)),!e.viewOnly){const t=p(e,r.move,s.move),i=p(e,r.end,s.end);for(const e of["touchmove","mousemove"])n.push(c(document,e,t));for(const e of["touchend","mouseup"])n.push(c(document,e,i));const o=()=>e.dom.bounds.clear();n.push(c(document,"scroll",o,{capture:!0,passive:!0})),n.push(c(window,"resize",o,{passive:!0}))}return()=>n.forEach((e=>e()))}},{"./board":3,"./drag":6,"./draw":7,"./drop":8,"./util":20}],10:[function(e,t,n){"use strict";function r(e,t){e.exploding&&(t?e.exploding.stage=t:e.exploding=void 0,e.dom.redraw())}Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e,t){e.exploding={stage:1,keys:t},e.dom.redraw(),setTimeout((()=>{r(e,2),setTimeout((()=>r(e,void 0)),120)}),120)}},{}],11:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.write=n.read=n.initial=void 0;const r=e("./util");function s(e){return e.replace("+","p")+"-piece"}function i(e){const t=e.slice(0,e.indexOf("-"));return t.length>1?t.replace("p","+"):t}n.initial="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",n.read=function(e,t,i){"start"===e&&(e=n.initial),-1!==e.indexOf("[")&&(e=e.slice(0,e.indexOf("[")));const o=new Map;let a=t.height,c=0,p=!1,d=0;for(const n of e)switch(n){case" ":return o;case"/":if(--a,0===a)return o;c=0,d=0;break;case"+":p=!0;break;case"~":{const e=o.get((0,r.pos2key)([c,a]));e&&(e.promoted=!0);break}default:{const e=n.charCodeAt(0);if(48<=e&&e<58)d=d+e-48;else{c+=1+d,d=0;const e="oware"===i?n:n.toLowerCase(),t="oware"===i&&1===a?"p1":"oware"===i&&2===a||n===e?"p2":"p1",l={role:s(e),playerIndex:t};p&&(l.role="p"+l.role,l.promoted=!0,p=!1),o.set((0,r.pos2key)([c,a]),l)}}}return o},n.write=function(e,t,n){return r.invNRanks.slice(-t.height).map((s=>r.NRanks.slice(0,t.width).map((t=>{const o=e.get((0,r.pos2key)([t,s]));if(o){const e=i(o.role)+(o.promoted&&"+"!==i(o.role).charAt(0)?"~":"");return"p1"===o.playerIndex&&"oware"!==n?e.toUpperCase():e}return"1"})).join(""))).join("/").replace(/1{2,}/g,(e=>e.length.toString()))}},{"./util":20}],12:[function(e,t,n){t.exports=e("./chessground").Chessground},{"./chessground":4}],13:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./util"),s=(e,t)=>!0;function i(e,t,n,r){const s=r.height;return e<1&&(e+=s),t<1&&(t+=s),(r,i)=>("p2"===n&&(i=s-i+1),e<=i&&i<=t)}n.default=function(e,t,n,o){const a=t.playerIndex,c=t.role;let p=s;switch(o){case"crazyhouse":case"shouse":case"capahouse":case"gothhouse":if("p-piece"===c)p=i(2,-1,a,n);break;case"placement":p=i(1,1,a,n);break;case"sittuyin":if("r-piece"===c)p=i(1,1,a,n);else p=(e,t)=>{const r=n.width,s=n.height;return"p2"===a&&(e=r-e+1,t=s-t+1),t<3||3===t&&e>4};break;case"shogi":case"minishogi":case"gorogoro":switch(c){case"p-piece":case"l-piece":p=i(1,-1,a,n);break;case"n-piece":p=i(1,-2,a,n)}break;case"kyotoshogi":case"dobutsu":p=s;break;case"torishogi":if("s-piece"===c)p=i(1,-1,a,n);break;case"grandhouse":if("p-piece"===c)p=i(2,7,a,n);break;case"shogun":p=i(1,5,a,n);break;case"synochess":p=(e,t)=>5===t;break;case"shinobi":p=(e,t)=>t<=4;break;case"flipello":p=function(e){return(t,n)=>{const s=r.pos2key([t,n]);return!e.has(s)}}(e);break;default:console.warn("Unknown drop variant",o)}return r.allKeys(n).map(r.key2pos).filter((t=>{var n;return(null===(n=e.get(r.pos2key(t)))||void 0===n?void 0:n.playerIndex)!==a&&p(t[0],t[1])})).map(r.pos2key)}},{"./util":20}],14:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.premove=n.loachecker=n.queen=n.knight=void 0;const r=e("./util");function s(e,t){return Math.abs(e-t)}function i(e){return(t,n,r,i)=>s(t,r)<2&&("p1"===e?i===n+1||n<=2&&i===n+2&&t===r:i===n-1||n>=7&&i===n-2&&t===r)}n.knight=(e,t,n,r)=>{const i=s(e,n),o=s(t,r);return 1===i&&2===o||2===i&&1===o};const o=(e,t,n,r)=>s(e,n)===s(t,r),a=(e,t,n,r)=>e===n||t===r;n.queen=(e,t,n,r)=>o(e,t,n,r)||a(e,t,n,r);function c(e,t,n){return(i,o,a,c)=>s(i,a)<2&&s(o,c)<2||n&&o===c&&o===("p1"===e?1:8)&&(5===i&&(r.containsX(t,1)&&3===a||r.containsX(t,8)&&7===a)||r.containsX(t,a))}function p(e,t){const n="p1"===t?"1":"8",s=[];for(const[i,o]of e)i[1]===n&&o&&o.playerIndex===t&&"r-piece"===o.role&&s.push(r.key2pos(i)[0]);return s}n.loachecker=(e,t,n,r)=>o(e,t,n,r)||a(e,t,n,r);const d=(e,t,n,r)=>s(e,n)<2&&s(t,r)<2;function l(e,t,n){return(s,i,o,a)=>d(s,i,o,a)||n&&i===a&&i===("p1"===e?1:8)&&r.containsX(t,o)}const u=(e,t,n,r)=>{const i=s(e,n),o=s(t,r);return 1===i&&0===o||0===i&&1===o},f=(e,t,n,r)=>s(e,n)===s(t,r)&&1===s(e,n),h=(e,t,r,s)=>o(e,t,r,s)||(0,n.knight)(e,t,r,s),b=(e,t,r,s)=>a(e,t,r,s)||(0,n.knight)(e,t,r,s),g=(e,t,r,s)=>o(e,t,r,s)||a(e,t,r,s)||(0,n.knight)(e,t,r,s),m=(e,t,r,s)=>d(e,t,r,s)||(0,n.knight)(e,t,r,s);function v(e){return(t,n,r,i)=>s(t,r)<2&&("p1"===e?i===n+1||n<=3&&i===n+2&&t===r:i===n-1||n>=8&&i===n-2&&t===r)}function k(e){return(t,n,r,s)=>r===t&&("p1"===e?s>n:s<n)}function y(e){return(t,n,r,s)=>f(t,n,r,s)||t===r&&("p1"===e?s===n+1:s===n-1)}function w(e){return(t,n,r,i)=>u(t,n,r,i)||s(t,r)<2&&("p1"===e?i===n+1:i===n-1)}function P(e){return(t,n,r,s)=>r===t&&("p1"===e?s===n+1:s===n-1)}function x(e){return(t,n,r,s)=>(r===t-1||r===t+1)&&("p1"===e?s===n+2:s===n-2)}const I=(e,t,n,r)=>a(e,t,n,r)||f(e,t,n,r),M=(e,t,n,r)=>o(e,t,n,r)||u(e,t,n,r);function C(e,t){const n=Math.floor((e.width+1)/2),r="p1"===t?1:e.height-2;return[[n-1,r+2],[n,r+2],[n+1,r+2],[n-1,r+1],[n,r+1],[n+1,r+1],[n-1,r],[n,r],[n+1,r]]}function S(e){return(t,n,r,i)=>r===t&&("p1"===e?i===n+1:i===n-1)||i===n&&s(t,r)<2}function q(e){return(t,n,r,i)=>((e,t,n,r)=>{const i=s(e,n);return i===s(t,r)&&2===i})(t,n,r,i)&&("p1"===e?i<6:i>5)}function D(e,t){const n=C(t,e);return(e,t,r,s)=>u(e,t,r,s)&&n.some((e=>e[0]===r&&e[1]===s))}const O=(e,t,n,r)=>s(e,n)===s(t,r)&&s(e,n)<3,A=(e,t,n,r)=>{const i=s(e,n),o=s(t,r);return 2===i&&3===o||3===i&&2===o};const K=(e,t,n,r)=>{const i=s(e,n),o=s(t,r);return!(1!==i&&2!==i||1!==o&&2!==o)},T=(e,t,n,r)=>{const i=s(e,n),o=s(t,r);return 0===i&&(2===o||3===o)||0===o&&(2===i||3===i)||i===o&&(2===i||3===i)},_=(e,t,n,r)=>{const i=s(e,n),o=s(t,r);return 1===i||1===o||2===i&&(0===o||2===o)||0===i&&2===o},N=(e,t,n,r)=>{const i=s(e,n),o=s(t,r);return i<3&&(o<2||2===o&&0===i)},F=(e,t,r,i)=>{const o=s(e,r),a=s(t,i);return(0,n.knight)(e,t,r,i)||1===o&&3===a||3===o&&1===a},E=(e,t,r,s)=>(0,n.knight)(e,t,r,s)||(0,n.queen)(e,t,r,s),U=(e,t,n,r)=>{const i=s(e,n),o=s(t,r);return i===o&&i<4||0===o&&2===i||2===o&&i<2},j=(e,t,n,r)=>{const i=s(e,n),o=s(t,r);return i<3&&o<3&&!(1===i&&0===o)&&!(0===i&&1===o)};const R=(e,t,n,r)=>d(e,t,n,r)&&r!==t;n.premove=function(e,t,L,B,V,W){const $=e.get(t),X=$.role,z=$.playerIndex;if(!$)return[];const H=r.key2pos(t);let G;switch(V){case"xiangqi":case"manchu":switch(X){case"p-piece":G=function(e){return(t,n,r,i)=>r===t&&("p1"===e?i===n+1:i===n-1)||i===n&&s(t,r)<2&&("p1"===e?n>5:n<6)}(z);break;case"c-piece":case"r-piece":G=a;break;case"n-piece":G=n.knight;break;case"b-piece":G=q(z);break;case"a-piece":G=function(e,t){const n=C(t,e);return(e,t,r,s)=>f(e,t,r,s)&&n.some((e=>e[0]===r&&e[1]===s))}(z,B);break;case"k-piece":G=D(z,B);break;case"m-piece":G=b}break;case"janggi":switch($.role){case"p-piece":G=function(e,t){const n=C(t,r.opposite(e));return(t,r,i,o)=>{let a;switch(n.findIndex((e=>e[0]===t&&e[1]===r))){case 0:a=(t,n,r,s)=>r===t+1&&"p2"===e&&s===n-1;break;case 2:a=(t,n,r,s)=>r===t-1&&"p2"===e&&s===n-1;break;case 4:a=(t,n,r,i)=>1===s(t,r)&&("p1"===e?i===n+1:i===n-1);break;case 6:a=(t,n,r,s)=>r===t+1&&"p1"===e&&s===n+1;break;case 8:a=(t,n,r,s)=>r===t-1&&"p1"===e&&s===n+1;break;default:a=()=>!1}return i===t&&("p1"===e?o===r+1:o===r-1)||o===r&&s(t,i)<2||a(t,r,i,o)}}(z,B);break;case"c-piece":case"r-piece":G=function(e){const t=C(e,"p1"),n=C(e,"p2");return(e,r,i,o)=>{let c;const p=t.findIndex((t=>t[0]===e&&t[1]===r)),d=n.findIndex((t=>t[0]===e&&t[1]===r)),l=-1!==p?p:d,u=s(e,i),h=s(r,o);switch(l){case 0:c=(e,t,n,r)=>u===h&&n>e&&n<=e+2&&r<t&&r>=t-2;break;case 2:c=(e,t,n,r)=>u===h&&n<e&&n>=e-2&&r<t&&r>=t-2;break;case 4:c=f;break;case 6:c=(e,t,n,r)=>u===h&&n>e&&n<=e+2&&r>t&&r<=t+2;break;case 8:c=(e,t,n,r)=>u===h&&n<e&&n>=e-2&&r>t&&r<=t+2;break;default:c=()=>!1}return a(e,r,i,o)||c(e,r,i,o)}}(B);break;case"n-piece":G=n.knight;break;case"b-piece":G=A;break;case"a-piece":case"k-piece":G=function(e,t){const n=C(t,e);return(e,t,r,s)=>{let i;switch(n.findIndex((n=>n[0]===e&&n[1]===t))){case 0:i=(e,t,n,r)=>n===e+1&&r===t-1;break;case 2:i=(e,t,n,r)=>n===e-1&&r===t-1;break;case 4:i=f;break;case 6:i=(e,t,n,r)=>n===e+1&&r===t+1;break;case 8:i=(e,t,n,r)=>n===e-1&&r===t+1;break;default:i=()=>!1}return(u(e,t,r,s)||i(e,t,r,s))&&n.some((e=>e[0]===r&&e[1]===s))}}(z,B)}break;case"minixiangqi":switch($.role){case"p-piece":G=S(z);break;case"c-piece":case"r-piece":G=a;break;case"n-piece":G=n.knight;break;case"k-piece":G=D(z,B)}break;case"shogi":case"minishogi":case"gorogoro":switch($.role){case"p-piece":G=P(z);break;case"l-piece":G=k(z);break;case"n-piece":G=x(z);break;case"k-piece":G=d;break;case"s-piece":G=y(z);break;case"pp-piece":case"pl-piece":case"pn-piece":case"ps-piece":case"g-piece":G=w(z);break;case"b-piece":G=o;break;case"r-piece":G=a;break;case"pr-piece":G=I;break;case"pb-piece":G=M}break;case"kyotoshogi":switch($.role){case"l-piece":G=k(z);break;case"pl-piece":case"pn-piece":G=w(z);break;case"s-piece":G=y(z);break;case"ps-piece":G=o;break;case"n-piece":G=x(z);break;case"p-piece":G=P(z);break;case"pp-piece":G=a;break;case"k-piece":G=d}break;case"dobutsu":switch($.role){case"c-piece":G=P(z);break;case"e-piece":G=f;break;case"g-piece":G=u;break;case"l-piece":G=d;break;case"pc-piece":G=w(z)}break;case"torishogi":switch(X){case"s-piece":G=P(z);break;case"ps-piece":G=function(e){return(t,n,r,i)=>{const o=s(t,r);return"p1"===e?2===o&&i===n+2||0===o&&i===n-2:2===o&&i===n-2||0===o&&i===n+2}}(z);break;case"l-piece":G=function(e){return(t,n,r,i)=>{const o=s(t,r),a=s(n,i);return"p1"===e?r===t&&i>n||o===a&&r>t&&i<n||r===t-1&&i===n-1:r===t&&i<n||o===a&&r<t&&i>n||r===t+1&&i===n+1}}(z);break;case"r-piece":G=function(e){return(t,n,r,i)=>{const o=s(t,r),a=s(n,i);return"p1"===e?r===t&&i>n||o===a&&r<t&&i<n||r===t+1&&i===n-1:r===t&&i<n||o===a&&r>t&&i>n||r===t-1&&i===n+1}}(z);break;case"p-piece":G=function(e){return(t,n,r,i)=>{const o=s(t,r);return"p1"===e?r===t&&i===n+2||1===o&&i===n-1:r===t&&i===n-2||1===o&&i===n+1}}(z);break;case"c-piece":G=R;break;case"f-piece":G=function(e){return(t,n,r,s)=>"p1"===e?d(t,n,r,s)&&!(r===t&&s===n-1):d(t,n,r,s)&&!(r===t&&s===n+1)}(z);break;case"pf-piece":G=function(e){return(t,n,r,i)=>{const o=s(t,r),a=s(n,i);return"p1"===e?d(t,n,r,i)||o===a&&(i>n||i<n&&a<=2)||r===t&&i<n:d(t,n,r,i)||o===a&&(i<n||i>n&&a<=2)||r===t&&i>n}}(z);break;case"k-piece":G=d}break;case"makruk":case"makpong":case"sittuyin":case"cambodian":switch(X){case"p-piece":G=i(z);break;case"r-piece":G=a;break;case"n-piece":G=n.knight;break;case"s-piece":G=y(z);break;case"f-piece":case"m-piece":G=f;break;case"k-piece":G=d}break;case"grand":case"grandhouse":switch(X){case"p-piece":G=v(z);break;case"r-piece":G=a;break;case"n-piece":G=n.knight;break;case"b-piece":G=o;break;case"q-piece":G=n.queen;break;case"c-piece":G=b;break;case"a-piece":G=h;break;case"k-piece":G=d}break;case"shako":switch(X){case"p-piece":G=v(z);break;case"c-piece":case"r-piece":G=a;break;case"n-piece":G=n.knight;break;case"b-piece":G=o;break;case"q-piece":G=n.queen;break;case"e-piece":G=O;break;case"k-piece":G=function(e,t,n){return(s,i,o,a)=>d(s,i,o,a)||n&&i===a&&i===("p1"===e?2:9)&&6===s&&(8===o&&r.containsX(t,9)||4===o&&r.containsX(t,2))}(z,function(e,t){const n="p1"===t?"2":"9",s=[];for(const[i,o]of e)i[1]===n&&o&&o.playerIndex===t&&"r-piece"===o.role&&s.push(r.key2pos(i)[0]);return s}(e,z),L)}break;case"shogun":switch(X){case"p-piece":G=i(z);break;case"pp-piece":G=d;break;case"r-piece":G=a;break;case"pr-piece":G=b;break;case"n-piece":G=n.knight;break;case"pn-piece":G=m;break;case"b-piece":G=o;break;case"pb-piece":G=h;break;case"f-piece":G=f;break;case"pf-piece":G=n.queen;break;case"k-piece":G=c(z,p(e,z),L)}break;case"orda":case"ordamirror":switch(X){case"p-piece":G=i(z);break;case"r-piece":G=a;break;case"n-piece":G=n.knight;break;case"b-piece":G=o;break;case"q-piece":G=n.queen;break;case"l-piece":G=b;break;case"h-piece":G=m;break;case"a-piece":G=h;break;case"y-piece":G=y(z);break;case"f-piece":G=g;break;case"k-piece":G=c(z,p(e,z),L)}break;case"synochess":switch(X){case"p-piece":G=i(z);break;case"c-piece":case"r-piece":G=a;break;case"n-piece":G=n.knight;break;case"b-piece":G=o;break;case"q-piece":G=n.queen;break;case"s-piece":G=S(z);break;case"e-piece":G=O;break;case"a-piece":G=d;break;case"k-piece":G=c(z,p(e,z),L&&"p1"===z)}break;case"musketeer":switch(X){case"p-piece":G=i(z);break;case"r-piece":G=a;break;case"n-piece":G=n.knight;break;case"b-piece":G=o;break;case"q-piece":G=n.queen;break;case"l-piece":G=K;break;case"o-piece":G=N;break;case"u-piece":G=F;break;case"d-piece":G=E;break;case"c-piece":G=b;break;case"a-piece":G=h;break;case"e-piece":G=_;break;case"h-piece":G=T;break;case"f-piece":G=U;break;case"s-piece":G=j;break;case"k-piece":G=c(z,p(e,z),L)}break;case"hoppelpoppel":switch(X){case"p-piece":G=i(z);break;case"r-piece":G=a;break;case"n-piece":case"b-piece":G=h;break;case"q-piece":G=n.queen;break;case"k-piece":G=c(z,p(e,z),L)}break;case"shinobi":switch(X){case"p-piece":G=i(z);break;case"pl-piece":case"r-piece":G=a;break;case"ph-piece":case"n-piece":G=n.knight;break;case"pm-piece":case"b-piece":G=o;break;case"q-piece":G=n.queen;break;case"pp-piece":case"c-piece":G=d;break;case"l-piece":G=k(z);break;case"h-piece":G=x(z);break;case"m-piece":G=f;break;case"d-piece":G=I;break;case"j-piece":G=h;break;case"k-piece":G=c(z,p(e,z),L)}break;case"empire":switch(X){case"p-piece":G=i(z);break;case"s-piece":G=S(z);break;case"r-piece":G=a;break;case"n-piece":G=n.knight;break;case"b-piece":G=o;break;case"d-piece":case"t-piece":case"c-piece":case"q-piece":G=n.queen;break;case"e-piece":G=g;break;case"k-piece":G=c(z,p(e,z),L)}break;case"capablanca":case"capahouse":switch(X){case"p-piece":G=i(z);break;case"r-piece":G=a;break;case"n-piece":G=n.knight;break;case"b-piece":G=o;break;case"q-piece":G=n.queen;break;case"c-piece":G=b;break;case"a-piece":G=h;break;case"k-piece":G=W?l(z,p(e,z),L):function(e,t,n){return(s,i,o,a)=>d(s,i,o,a)||n&&i===a&&i===("p1"===e?1:8)&&6===s&&(9===o&&r.containsX(t,10)||3===o&&r.containsX(t,1))}(z,p(e,z),L)}break;default:switch(X){case"p-piece":G=i(z);break;case"r-piece":G=a;break;case"n-piece":G=n.knight;break;case"b-piece":G=o;break;case"q-piece":G=n.queen;break;case"e-piece":case"c-piece":G=b;break;case"h-piece":case"a-piece":G=h;break;case"k-piece":G=W?l(z,p(e,z),L):c(z,p(e,z),L);break;case"l-piece":G=n.loachecker}}return r.allKeys(B).map(r.key2pos).filter((e=>(H[0]!==e[0]||H[1]!==e[1])&&G(H[0],H[1],e[0],e[1]))).map(r.pos2key)}},{"./util":20}],15:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.updateBounds=n.render=void 0;const r=e("./util"),s=e("./board"),i=e("./transformations");function o(e){return"PIECE"===e.tagName}function a(e){return"SQUARE"===e.tagName}function c(e,t){for(const n of t)e.dom.elements.board.removeChild(n)}function p(e,t,n,r){let s=2+((e=i.mapToP1[t](e,r))[1]-1)*r.height+(r.width-e[0]);return n&&(s=67-s),s+""}function d(e,t){const n=e.promoted?"promoted ":"",r=e.playerIndex===t?"ally":"enemy";return`${e.playerIndex} ${n}${e.role} ${r}`}function l(e,t,n){const r=e.get(t);r?e.set(t,`${r} ${n}`):e.set(t,n)}function u(e,t,n){const r=e.get(t);r?r.push(n):e.set(t,[n])}n.render=function(e){const t=e.orientation,n=(0,s.p1Pov)(e),i=e.dom.relative?r.posToTranslateRel:(0,r.posToTranslateAbs)(e.dom.bounds(),e.dimensions),f=e.dom.relative?r.translateRel:r.translateAbs,h=e.dom.elements.board,b=e.pieces,g=e.animation.current,m=g?g.plan.anims:new Map,v=g?g.plan.fadings:new Map,k=e.draggable.current,y=function(e){var t,n,r,s;const i=new Map;if(e.lastMove&&e.highlight.lastMove)for(const c of e.lastMove)"a0"!==c&&l(i,c,"last-move");e.check&&e.highlight.check&&l(i,e.check,"check");if(e.selected){if(l(i,e.selected,"selected"),e.movable.showDests){const n=null===(t=e.movable.dests)||void 0===t?void 0:t.get(e.selected);if(n)for(const t of n)l(i,t,"move-dest"+(e.pieces.has(t)?" oc":""));const r=e.premovable.dests;if(r)for(const t of r)l(i,t,"premove-dest"+(e.pieces.has(t)?" oc":""))}}else if(e.dropmode.active||"a0"===(null===(n=e.draggable.current)||void 0===n?void 0:n.orig)){const t=e.dropmode.active?e.dropmode.piece:null===(r=e.draggable.current)||void 0===r?void 0:r.piece;if(t){if(e.dropmode.showDropDests){const n=null===(s=e.dropmode.dropDests)||void 0===s?void 0:s.get(t.role);if(n)for(const e of n)l(i,e,"move-dest")}if(e.predroppable.showDropDests){const t=e.predroppable.dropDests;if(t)for(const n of t)l(i,n,"premove-dest"+(e.pieces.has(n)?" oc":""))}}}const o=e.premovable.current;if(o)for(const c of o)l(i,c,"current-premove");else e.predroppable.current&&l(i,e.predroppable.current.key,"current-premove");const a=e.exploding;if(a)for(const c of a.keys)l(i,c,"exploding"+a.stage);return i}(e),w=new Set,P=new Set,x=new Map,I=new Map;let M,C,S,q,D,O,A,K,T,_;for(C=h.firstChild;C;){if(M=C.cgKey,o(C))if(S=b.get(M),D=m.get(M),O=v.get(M),q=C.cgPiece,!C.cgDragging||k&&k.orig===M||(C.classList.remove("dragging"),f(C,i((0,r.key2pos)(M),t,e.dimensions)),C.cgDragging=!1),!O&&C.cgFading&&(C.cgFading=!1,C.classList.remove("fading")),S){if(D&&C.cgAnimating&&q===d(S,e.myPlayerIndex)){const n=(0,r.key2pos)(M);n[0]+=D[2],n[1]+=D[3],C.classList.add("anim"),f(C,i(n,t,e.dimensions))}else C.cgAnimating&&(C.cgAnimating=!1,C.classList.remove("anim"),f(C,i((0,r.key2pos)(M),t,e.dimensions)),e.addPieceZIndex&&(C.style.zIndex=p((0,r.key2pos)(M),t,n,e.dimensions)));q!==d(S,e.myPlayerIndex)||O&&C.cgFading?O&&q===d(O,e.myPlayerIndex)?(C.classList.add("fading"),C.cgFading=!0):u(x,q,C):w.add(M)}else u(x,q,C);else if(a(C)){const e=C.className;y.get(M)===e?P.add(M):I.has(e)?u(I,e,C):I.set(e,[C])}C=C.nextSibling}for(const[s,o]of y)if(!P.has(s)){T=I.get(o),_=T&&T.pop();const n=i((0,r.key2pos)(s),t,e.dimensions);if(_)_.cgKey=s,f(_,n);else{const e=(0,r.createEl)("square",o);e.cgKey=s,f(e,n),h.insertBefore(e,h.firstChild)}}for(const[s,o]of b)if(D=m.get(s),!w.has(s))if(A=x.get(d(o,e.myPlayerIndex)),K=A&&A.pop(),K){K.cgKey=s,K.cgFading&&(K.classList.remove("fading"),K.cgFading=!1);const o=(0,r.key2pos)(s);e.addPieceZIndex&&(K.style.zIndex=p(o,t,n,e.dimensions)),D&&(K.cgAnimating=!0,K.classList.add("anim"),o[0]+=D[2],o[1]+=D[3]),f(K,i(o,t,e.dimensions))}else{const a=d(o,e.myPlayerIndex),c=(0,r.createEl)("piece",a),l=(0,r.key2pos)(s);c.cgPiece=a,c.cgKey=s,D&&(c.cgAnimating=!0,l[0]+=D[2],l[1]+=D[3]),f(c,i(l,t,e.dimensions)),e.addPieceZIndex&&(c.style.zIndex=p(l,t,n,e.dimensions)),h.appendChild(c)}for(const r of x.values())c(e,r);for(const r of I.values())c(e,r)},n.updateBounds=function(e){if(e.dom.relative)return;const t=e.orientation,n=(0,r.posToTranslateAbs)(e.dom.bounds(),e.dimensions);let s=e.dom.elements.board.firstChild;for(;s;)(o(s)&&!s.cgAnimating||a(s))&&(0,r.translateAbs)(s,n((0,r.key2pos)(s.cgKey),t)),s=s.nextSibling}},{"./board":3,"./transformations":18,"./util":20}],16:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.defaults=void 0;const r=e("./fen"),s=e("./util");n.defaults=function(){return{pieces:r.read(r.initial,{width:8,height:8},"chess"),orientation:"p1",myPlayerIndex:"p1",startPlayerIndex:"p1",turnPlayerIndex:"p1",coordinates:!0,autoCastle:!0,viewOnly:!1,disableContextMenu:!1,resizable:!0,addPieceZIndex:!1,pieceKey:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,playerIndex:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,showDropDests:!0,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,centerPiece:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1,showDropDests:!0},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15}},pieces:{baseUrl:"https://playstrategy.org/assets/piece/cburnett/"},prevSvgHash:""},hold:(0,s.timer)(),dimensions:{width:8,height:8},variant:"chess",chess960:!1,notation:0,onlyDropsVariant:!1}}},{"./fen":11,"./util":20}],17:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.setAttributes=n.renderSvg=n.createElement=void 0;const r=e("./util"),s=e("./transformations");function i(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function o(e,t,n,r,s){const i=e.dom.bounds(),o=new Map,a=[];for(const d of t)o.set(d.hash,!1);let c,p=s.firstChild;for(;p;)c=p.getAttribute("cgHash"),o.has(c)?o.set(c,!0):a.push(p),p=p.nextSibling;for(const d of a)s.removeChild(d);for(const l of t)o.get(l.hash)||s.appendChild(d(e,l,n,r,i))}function a({orig:e,dest:t,brush:n,piece:r,modifiers:s,customSvg:i},o,a,d){return[d.width,d.height,a,e,t,n,t&&(o.get(t)||0)>1,r&&c(r),s&&(l=s,""+(l.lineWidth||"")),i&&p(i)].filter((e=>e)).join(",");var l}function c(e){return[e.playerIndex,e.role,e.scale].filter((e=>e)).join(",")}function p(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n)>>>0;return"custom-"+t.toString()}function d(e,{shape:t,current:n,hash:s},o,a,c){let p;if(t.customSvg){const n=f((0,r.key2pos)(t.orig),e.orientation,e.dimensions);p=function(e,t,n,r){const{width:s,height:o}=n,a=s/r.width,c=o/r.height,p=(t[0]-1)*a,d=(r.height-t[1])*c,l=u(i("g"),{transform:`translate(${p},${d})`}),f=u(i("svg"),{width:a,height:c,viewBox:"0 0 100 100"});return l.appendChild(f),f.innerHTML=e,l}(t.customSvg,n,c,e.dimensions)}else if(t.piece)p=function(e,t,n,r,s,o,a){const c=m(t,r,s),p=r.width/s.width*(n.scale||1),d=r.height/s.height*(n.scale||1),l=function(e,t){switch(e){case"shogi":switch(t.role){case"pp-piece":return"0TO";case"pl-piece":return"0NY";case"pn-piece":return"0NK";case"ps-piece":return"0NG";case"pr-piece":return"0RY";case"pb-piece":return"0UM";case"p-piece":return"0FU";case"l-piece":return"0KY";case"n-piece":return"0KE";case"s-piece":return"0GI";case"r-piece":return"0HI";case"b-piece":return"0KA";case"g-piece":return"0KI";case"k-piece":return"p1"===t.playerIndex?"0GY":"0OU";default:return""}case"xiangqi":return("p1"===t.playerIndex?"R":"B")+t.role[0].toUpperCase();case"flipello":case"linesOfAction":return("p1"===t.playerIndex?"b":"w")+t.role[0].toUpperCase();case"oware":{const e=t.role[0].charCodeAt(0);return e>90?(e-70).toString():(e-64).toString()}default:return("p1"===t.playerIndex?"w":"b")+t.role[0].toUpperCase()}}(a,n),f=e.endsWith("/")?e.slice("https://playstrategy.org".length)+l+".svg":e,h=n.playerIndex===o?"ally":"enemy";return u(i("image"),{className:`${n.role} ${n.playerIndex} ${h}`,x:c[0]-p/2,y:c[1]-d/2,width:p,height:d,href:f})}(e.drawable.pieces.baseUrl,f((0,r.key2pos)(t.orig),e.orientation,e.dimensions),t.piece,c,e.dimensions,e.myPlayerIndex,e.variant);else{const s=f((0,r.key2pos)(t.orig),e.orientation,e.dimensions);if(t.orig&&t.dest){let d=o[t.brush];t.modifiers&&(d=h(d,t.modifiers)),p=function(e,t,n,r,s,o,a){const c=function(e,t,n){return(t?20:10)/(64*n.width)*e.width}(o,s&&!r,a),p=m(t,o,a),d=m(n,o,a),l=d[0]-p[0],f=d[1]-p[1],h=Math.atan2(f,l),v=Math.cos(h)*c,k=Math.sin(h)*c;return u(i("line"),{stroke:e.color,"stroke-width":b(e,r,o,a),"stroke-linecap":"round","marker-end":"url(#arrowhead-"+e.key+")",opacity:g(e,r),x1:p[0],y1:p[1],x2:d[0]-v,y2:d[1]-k})}(d,s,f((0,r.key2pos)(t.dest),e.orientation,e.dimensions),n,(a.get(t.dest)||0)>1,c,e.dimensions)}else p=function(e,t,n,r,s){const o=m(t,r,s),a=function(e,t){const n=e.width/(64*t.width);return[3*n,4*n]}(r,s),c=(r.width+r.height)/(2*(s.height+s.width));return u(i("circle"),{stroke:e.color,"stroke-width":a[n?0:1],fill:"none",opacity:g(e,n),cx:o[0],cy:o[1],r:c-a[1]/2})}(o[t.brush],s,n,c,e.dimensions)}return p.setAttribute("cgHash",s),p}function l(e){const t=u(i("marker"),{id:"arrowhead-"+e.key,orient:"auto",markerWidth:4,markerHeight:8,refX:2.05,refY:2.01});return t.appendChild(u(i("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),t.setAttribute("cgKey",e.key),t}function u(e,t){for(const n in t)e.setAttribute(n,t[n]);return e}function f(e,t,n){return s.mapToP1Inverse[t](e,n)}function h(e,t){return{color:e.color,opacity:Math.round(10*e.opacity)/10,lineWidth:Math.round(t.lineWidth||e.lineWidth),key:[e.key,t.lineWidth].filter((e=>e)).join("")}}function b(e,t,n,r){return(e.lineWidth||10)*(t?.85:1)/(64*r.width)*n.width}function g(e,t){return(e.opacity||1)*(t?.9:1)}function m(e,t,n){return[(e[0]-.5)*t.width/n.width,(n.height+.5-e[1])*t.height/n.height]}n.createElement=i,n.renderSvg=function(e,t,n){const r=e.drawable,s=r.current,i=s&&s.mouseSq?s:void 0,c=new Map,p=e.dom.bounds();for(const o of r.shapes.concat(r.autoShapes).concat(i?[i]:[]))o.dest&&c.set(o.dest,(c.get(o.dest)||0)+1);const d=r.shapes.concat(r.autoShapes).map((e=>({shape:e,current:!1,hash:a(e,c,!1,p)})));i&&d.push({shape:i,current:!0,hash:a(i,c,!0,p)});const u=d.map((e=>e.hash)).join(";");if(u===e.drawable.prevSvgHash)return;e.drawable.prevSvgHash=u;const f=t.querySelector("defs"),b=t.querySelector("g"),g=n.querySelector("g");!function(e,t,n){const r=new Map;let s;for(const a of t)a.shape.dest&&(s=e.brushes[a.shape.brush],a.shape.modifiers&&(s=h(s,a.shape.modifiers)),r.set(s.key,s));const i=new Set;let o=n.firstChild;for(;o;)i.add(o.getAttribute("cgKey")),o=o.nextSibling;for(const[a,c]of r.entries())i.has(a)||n.appendChild(l(c))}(r,d,f),o(e,d.filter((e=>!e.shape.customSvg)),r.brushes,c,b),o(e,d.filter((e=>e.shape.customSvg)),r.brushes,c,g)},n.setAttributes=u},{"./transformations":18,"./util":20}],18:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.translateBase=n.mapToP1Inverse=n.mapToP1=void 0,n.mapToP1={p1:(e,t)=>e,p2:(e,t)=>[t.width+1-e[0],t.height+1-e[1]],right:(e,t)=>[t.height+1-e[1],e[0]],left:(e,t)=>[e[1],t.width+1-e[0]]},n.mapToP1Inverse={p1:(e,t)=>e,p2:(e,t)=>[t.width+1-e[0],t.height+1-e[1]],right:(e,t)=>[e[1],t.width+1-e[0]],left:(e,t)=>[t.width+1-e[0],e[1]]},n.translateBase={p1:(e,t,n,r)=>[(e[0]-1)*t,(r.height-e[1])*n],p2:(e,t,n,r)=>[(r.width-e[0])*t,(e[1]-1)*n],right:(e,t,n,r)=>[(e[1]-1)*t,(e[0]-1)*n],left:(e,t,n,r)=>[(r.width-e[0])*t,(e[1]-1)*n]}},{}],19:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.xiangqiVariants=n.shogiVariants=n.letters=n.ranks10=n.ranks=n.files=n.playerIndexs=n.orientations=void 0,n.orientations=["p1","p2","left","right"],n.playerIndexs=["p1","p2"],n.files=["a","b","c","d","e","f","g","h","i","j"],n.ranks=["1","2","3","4","5","6","7","8","9",":"],n.ranks10=["1","2","3","4","5","6","7","8","9","10"],n.letters=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],n.shogiVariants=["shogi","minishogi","kyotoshogi","dobutsu","gorogoro","torishogi"],n.xiangqiVariants=["xiangqi","minixiangqi","manchu","janggi"]},{}],20:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.callUserFunction=n.computeSquareCenter=n.createEl=n.isRightButton=n.eventPosition=n.setVisible=n.translateRel=n.translateAbs=n.posToTranslateRel=n.posToTranslateAbs=n.samePiece=n.distanceSq=n.containsX=n.isPlayerIndex=n.orientationForLOA=n.oppositeOrientationForLOA=n.oppositeOrientation=n.opposite=n.timer=n.memo=n.allPos=n.key2pos=n.pos2key=n.allKeys=n.invNRanks=n.NRanks=n.invRanks=n.playerIndexs=void 0;const r=e("./types"),s=e("./transformations");function i(e={width:8,height:8}){return Array.prototype.concat(...(t=e.width,r.files.slice(0,t)).map((t=>function(e){return r.ranks10.slice(0,e)}(e.height).map((e=>t+e)))));var t}function o(e){return[e.charCodeAt(0)-96,parseInt(e.slice(1))]}n.playerIndexs=["p1","p2"],n.invRanks=[...r.ranks10].reverse(),n.NRanks=[1,2,3,4,5,6,7,8,9,10],n.invNRanks=[10,9,8,7,6,5,4,3,2,1],n.allKeys=i,n.pos2key=function(e){return r.files[e[0]-1]+r.ranks10[e[1]-1]},n.key2pos=o;n.allPos=e=>i(e).map(o),n.memo=function(e){let t;const n=()=>(void 0===t&&(t=e()),t);return n.clear=()=>{t=void 0},n};n.timer=()=>{let e;return{start(){e=performance.now()},cancel(){e=void 0},stop(){if(!e)return 0;const t=performance.now()-e;return e=void 0,t}}};n.opposite=e=>"p1"===e?"p2":"p1";const a={p1:"p2",p2:"p1",left:"right",right:"left"};n.oppositeOrientation=e=>a[e];const c={p1:"right",p2:"p1"};n.oppositeOrientationForLOA=e=>c[e];const p={p1:"p1",p2:"right"};n.orientationForLOA=e=>p[e];n.isPlayerIndex=e=>"p1"===e||"p2"===e,n.containsX=function(e,t){return void 0!==e&&-1!==e.indexOf(t)};n.distanceSq=(e,t)=>{const n=e[0]-t[0],r=e[1]-t[1];return n*n+r*r};n.samePiece=(e,t)=>e.role===t.role&&e.playerIndex===t.playerIndex;const d=(e,t,n,r,i)=>s.translateBase[t](e,n,r,i);n.posToTranslateAbs=(e,t)=>{const n=e.width/t.width,r=e.height/t.height;return(e,s)=>d(e,s,n,r,t)};n.posToTranslateRel=(e,t,n)=>d(e,t,100,100,n);n.translateAbs=(e,t)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px)`};n.translateRel=(e,t)=>{e.style.transform=`translate(${t[0]}%,${t[1]}%)`};n.setVisible=(e,t)=>{e.style.visibility=t?"visible":"hidden"};n.eventPosition=e=>{var t;return e.clientX||0===e.clientX?[e.clientX,e.clientY]:(null===(t=e.targetTouches)||void 0===t?void 0:t[0])?[e.targetTouches[0].clientX,e.targetTouches[0].clientY]:void 0};n.isRightButton=e=>2===e.buttons||2===e.button;n.createEl=(e,t)=>{const n=document.createElement(e);return t&&(n.className=t),n},n.computeSquareCenter=function(e,t,n,r){const i=s.mapToP1Inverse[t](o(e),r);return[n.left+n.width*(i[0]-1+.5)/r.width,n.top+n.height*(r.height-(i[1]-1+.5))/r.height]},n.callUserFunction=function(e,...t){e&&setTimeout((()=>e(...t)),1)}},{"./transformations":18,"./types":19}],21:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.renderWrap=void 0;const r=e("./util"),s=e("./types"),i=e("./svg");function o(e,t){const n=(0,r.createEl)("coords",t);let s;for(const i of e)s=(0,r.createEl)("coord"),s.textContent=i,n.appendChild(s);return n}n.renderWrap=function(e,t,n){e.innerHTML="",e.classList.add("cg-wrap");for(const r of s.orientations)e.classList.toggle("orientation-"+r,t.orientation===r);e.classList.toggle("manipulable",!t.viewOnly);const a=(0,r.createEl)("cg-helper");e.appendChild(a);const c=(0,r.createEl)("cg-container");a.appendChild(c);const p=(0,r.createEl)("extension");c.appendChild(p);const d=(0,r.createEl)("cg-board");let l,u,f;if(c.appendChild(d),t.drawable.visible&&!n&&(l=(0,i.setAttributes)((0,i.createElement)("svg"),{class:"cg-shapes"}),l.appendChild((0,i.createElement)("defs")),l.appendChild((0,i.createElement)("g")),u=(0,i.setAttributes)((0,i.createElement)("svg"),{class:"cg-custom-svgs"}),u.appendChild((0,i.createElement)("g")),c.appendChild(l),c.appendChild(u)),t.coordinates){const e=" "+t.orientation,n=s.shogiVariants.includes(t.variant),r=s.xiangqiVariants.includes(t.variant);n?(c.appendChild(o(s.ranks.slice(0,t.dimensions.height).reverse(),"files"+e)),c.appendChild(o(s.ranks.slice(0,t.dimensions.width).reverse(),"ranks"+e))):6===t.notation?(c.appendChild(o(["0"].concat(s.ranks.slice(0,9).reverse()),"ranks"+e)),c.appendChild(o(s.ranks.slice(0,9),"files"+e))):r?"p1"===t.orientation?(c.appendChild(o(s.ranks10.slice(0,t.dimensions.width).reverse(),"files p1")),c.appendChild(o(s.ranks10.slice(0,t.dimensions.width).reverse(),"files p2"))):(c.appendChild(o(s.ranks10.slice(0,t.dimensions.width),"files p1")),c.appendChild(o(s.ranks10.slice(0,t.dimensions.width),"files p2"))):"flipello"===t.variant?(c.appendChild(o(s.ranks10.slice(0,t.dimensions.height).reverse(),"ranks"+e)),c.appendChild(o(s.files.slice(0,t.dimensions.width),"files"+e))):"oware"===t.variant?"p1"===t.orientation?(c.appendChild(o(s.files.slice(0,t.dimensions.width).map((e=>e.toUpperCase())),"files p1")),c.appendChild(o(s.files.slice(0,t.dimensions.width),"files p2"))):(c.appendChild(o(s.files.slice(0,t.dimensions.width).map((e=>e.toUpperCase())).reverse(),"files p1")),c.appendChild(o(s.files.slice(0,t.dimensions.width).reverse(),"files p2"))):(c.appendChild(o(s.ranks10.slice(0,t.dimensions.height),"ranks"+e)),c.appendChild(o(s.files.slice(0,t.dimensions.width),"files"+e)))}return t.draggable.showGhost&&!n&&(f=(0,r.createEl)("piece","ghost"),(0,r.setVisible)(f,!1),c.appendChild(f)),{board:d,container:c,ghost:f,svg:l,customSvg:u}}},{"./svg":17,"./types":19,"./util":20}]},{},[12])(12)}));