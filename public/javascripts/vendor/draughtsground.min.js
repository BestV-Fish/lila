var Draughtsground=function(){"use strict";const e=["white","black"],t=["01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50"],o=["b8","d8","f8","h8","a7","c7","e7","g7","b6","d6","f6","h6","a5","c5","e5","g5","b4","d4","f4","h4","a3","c3","e3","g3","b2","d2","f2","h2","a1","c1","e1","g1"],n={1:"b8",2:"d8",3:"f8",4:"h8",5:"a7",6:"c7",7:"e7",8:"g7",9:"b6",10:"d6",11:"f6",12:"h6",13:"a5",14:"c5",15:"e5",16:"g5",17:"b4",18:"d4",19:"f4",20:"h4",21:"a3",22:"c3",23:"e3",24:"g3",25:"b2",26:"d2",27:"f2",28:"h2",29:"a1",30:"c1",31:"e1",32:"g1"},r=["8","7","6","5","4","3","2","1"],i=["a","b","c","d","e","f","g","h"],a=(e,o)=>t[e[0]+o[0]/2*(e[1]-1)-1],s=e=>e<10?"0"+e.toString():e.toString(),c=(e,t)=>l(parseInt(e),t),l=(e,t)=>[(e-1)%(t[0]/2)+1,(e-1+(t[0]/2-(e-1)%(t[0]/2)))/(t[1]/2)];const d=()=>{let e;return{start(){e=performance.now()},cancel(){e=void 0},stop(){if(!e)return 0;const t=performance.now()-e;return e=void 0,t}}},u=e=>"white"===e?"black":"white";function p(e,t){return void 0!==e&&-1!==e.indexOf(t)}const g=(e,t)=>{const o=e[0]-t[0],n=e[1]-t[1];return o*o+n*n},f=(e,t)=>e.role===t.role&&e.color===t.color,h=(e,t,o,n,r,i)=>{const a=t[0]/2-.5;return 0!==i?[(o?i-.5+e[0]:a-(i-.5+e[0]))*n,(o?e[1]-1:t[1]-e[1])*r]:[(o?(e[1]%2!=0?-.5:-1)+e[0]:a-((e[1]%2!=0?-.5:-1)+e[0]))*n,(o?e[1]-1:t[1]-e[1])*r]},m=(e,t)=>{const o=e.width/(t[0]/2),n=e.height/t[1];return(e,r,i)=>h(e,t,r,o,n,i)},b=(e,t)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px)`},v=(e,t)=>{e.style.left=t[0]+"%",e.style.top=t[1]+"%"},w=e=>b(e,[-99999,-99999]),k=e=>e.clientX||0===e.clientX?[e.clientX,e.clientY]:e.touches&&e.targetTouches[0]?[e.targetTouches[0].clientX,e.targetTouches[0].clientY]:void 0,y=e=>2===e.buttons||2===e.button,M=(e,t)=>{const o=document.createElement(e);return t&&(o.className=t),o};function S(e){for(let t in e)return!1;return!0}const z=[[-1,-1,-1],[6,7,11],[7,8,12],[8,9,13],[9,10,14],[10,-1,15],[-1,11,16],[11,12,17],[12,13,18],[13,14,19],[14,15,20],[16,17,21],[17,18,22],[18,19,23],[19,20,24],[20,-1,25],[-1,21,26],[21,22,27],[22,23,28],[23,24,29],[24,25,30],[26,27,31],[27,28,32],[28,29,33],[29,30,34],[30,-1,35],[-1,31,36],[31,32,37],[32,33,38],[33,34,39],[34,35,40],[36,37,41],[37,38,42],[38,39,43],[39,40,44],[40,-1,45],[-1,41,46],[41,42,47],[42,43,48],[43,44,49],[44,45,50],[46,47,-1],[47,48,-1],[48,49,-1],[49,50,-1],[50,-1,-1],[-1,-1,-1],[-1,-1,-1],[-1,-1,-1],[-1,-1,-1],[-1,-1,-1]],C=[[-1,-1,-1],[5,6,9],[6,7,10],[7,8,11],[8,-1,12],[-1,9,13],[9,10,14],[10,11,15],[11,12,16],[13,14,17],[14,15,18],[15,16,19],[16,-1,20],[-1,17,21],[17,18,22],[18,19,23],[19,20,24],[21,22,25],[22,23,26],[23,24,27],[24,-1,28],[-1,25,29],[25,26,30],[26,27,31],[27,28,32],[29,30,-1],[30,31,-1],[31,32,-1],[32,-1,-1],[-1,-1,-1],[-1,-1,-1],[-1,-1,-1],[-1,-1,-1]],P=[[-1,-1,-1],[-1,-1,-1],[-1,-1,-1],[-1,-1,-1],[-1,-1,-1],[-1,-1,-1],[-1,1,-1],[1,2,-1],[2,3,-1],[3,4,-1],[4,5,-1],[6,7,1],[7,8,2],[8,9,3],[9,10,4],[10,-1,5],[-1,11,6],[11,12,7],[12,13,8],[13,14,9],[14,15,10],[16,17,11],[17,18,12],[18,19,13],[19,20,14],[20,-1,15],[-1,21,16],[21,22,17],[22,23,18],[23,24,19],[24,25,20],[26,27,21],[27,28,22],[28,29,23],[29,30,24],[30,-1,25],[-1,31,26],[31,32,27],[32,33,28],[33,34,29],[34,35,30],[36,37,31],[37,38,32],[38,39,33],[39,40,34],[40,-1,35],[-1,41,36],[41,42,37],[42,43,38],[43,44,39],[44,45,40]],x=[[-1,-1,-1],[-1,-1,-1],[-1,-1,-1],[-1,-1,-1],[-1,-1,-1],[-1,1,-1],[1,2,-1],[2,3,-1],[3,4,-1],[5,6,1],[6,7,2],[7,8,3],[8,-1,4],[-1,9,5],[9,10,6],[10,11,7],[11,12,8],[13,14,9],[14,15,10],[15,16,11],[16,-1,12],[-1,17,13],[17,18,14],[18,19,15],[19,20,16],[21,22,17],[22,23,18],[23,24,19],[24,-1,20],[-1,25,21],[25,26,22],[26,27,23],[27,28,24]],L=[[-1,-1],[-1,2],[1,3],[2,4],[3,5],[4,-1],[-1,7],[6,8],[7,9],[8,10],[9,-1],[-1,12],[11,13],[12,14],[13,15],[14,-1],[-1,17],[16,18],[17,19],[18,20],[19,-1],[-1,22],[21,23],[22,24],[23,25],[24,-1],[-1,27],[26,28],[27,29],[28,30],[29,-1],[-1,32],[31,33],[32,34],[33,35],[34,-1],[-1,37],[36,38],[37,39],[38,40],[39,-1],[-1,42],[41,43],[42,44],[43,45],[44,-1],[-1,47],[46,48],[47,49],[48,50],[49,-1]],N=[[-1,-1],[-1,2],[1,3],[2,4],[3,-1],[-1,6],[5,7],[6,8],[7,-1],[-1,10],[9,11],[10,12],[11,-1],[-1,14],[13,15],[14,16],[15,-1],[-1,18],[17,19],[18,20],[19,-1],[-1,22],[21,23],[22,24],[23,-1],[-1,26],[25,27],[26,28],[27,-1],[-1,30],[29,31],[30,32],[31,-1]];function K(e,t,o,n){const r=e.get(o),i=Number(o);if(void 0===r||isNaN(i))return new Array;const a=n&&("frisian"===n||"frysk"===n),c=10===t[0],l=c?P:x,d=c?z:C,u=c?L:N,p=new Array;switch(r.role){case"man":for(let t=0;t<(a?3:2);t++){let o=l[i][t];if(-1!=o){const n=s(o);"white"===r.color&&t<2&&p.push(n);const i=e.get(n);void 0!==i&&i.color===r.color||(o=l[o][t],-1!==o&&p.push(s(o)))}}for(let t=0;t<(a?3:2);t++){let o=d[i][t];if(-1!=o){const n=s(o);"black"===r.color&&t<2&&p.push(n);const i=e.get(n);void 0!==i&&i.color===r.color||(o=d[o][t],-1!==o&&p.push(s(o)))}}if(a)for(let t=0;t<2;t++){let o=u[i][t];if(-1!=o){const n=e.get(s(o));void 0!==n&&n.color===r.color||(o=u[o][t],-1!==o&&p.push(s(o)))}}break;case"king":for(let e=0;e<(a?3:2);e++){let t=l[i][e],o=0;for(;-1!=t;)(e<2||o>0)&&p.push(s(t)),t=l[t][e],o++}for(let e=0;e<(a?3:2);e++){let t=d[i][e],o=0;for(;-1!=t;)(e<2||o>0)&&p.push(s(t)),t=d[t][e],o++}if(a)for(let e=0;e<2;e++){let t=u[i][e],o=0;for(;-1!=t;)o>0&&p.push(s(t)),t=u[t][e],o++}}return p}function O(e){const t=[];if(e.length>1)for(let o=0;o<e.length;o+=2)t.push(e.substr(o,2));return t}function E(e,...t){e&&setTimeout((()=>e(...t)),1)}function A(e){e.premovable.current&&(e.premovable.current=void 0,E(e.premovable.events.unset))}function D(e){const t=e.predroppable;t.current&&(t.current=void 0,E(t.events.unset))}function W(e,t,o,n,r,i){const s=r-o,c=i-n,l=0===c?0:c>0?0===s&&Math.abs(c)>=2?2:1:0===s&&Math.abs(c)>=2?-2:-1,d=0===s?0:0===c?s>0?1:-1:n%2==0?s<0?-1:0:s>0?1:0;if(0===d&&0===l)return;const u=[o+d,n+l];if(void 0===u)return;const p=a(u,t),g=e.get(p);return void 0!==g&&"ghostman"!==g.role&&"ghostking"!==g.role?p:W(e,t,o+d,n+l,r,i)}function q(e,o,n,r){const i=e.pieces.get(o);if(o===n||!i){if(r){for(let o=0;o<t.length;o++){const n=t[o],r=e.pieces.get(n);!r||"ghostking"!==r.role&&"ghostman"!==r.role||e.pieces.delete(n)}n==e.selected&&U(e)}return!1}const a=e.movable.captLen&&e.movable.captLen>0,s=e.boardSize,l=a&&e.movable.captureUci&&function(e,t){for(let o of e)if(t(o))return o}(e.movable.captureUci,(e=>e.slice(0,2)===o&&e.slice(-2)===n)),d=c(o,s),u=c(l?l.slice(2,4):n,s),p=a?W(e.pieces,s,d[0],d[1],u[0],u[1]):void 0,g=a&&p?e.pieces.get(p):void 0;n==e.selected&&U(e),E(e.events.move,o,n,g);const f=l?(l.length-2)/2:1,h=l?c(l.slice(l.length-2),s):u,m=e.movable&&e.movable.variant||e.premovable&&e.premovable.variant,b=("russian"===m||!e.movable.captLen||e.movable.captLen<=f)&&"man"===i.role&&("white"===i.color&&1===h[1]||"black"===i.color&&h[1]===e.boardSize[1]),v=!e.movable.free&&b?{role:"king",color:i.color}:e.pieces.get(o);if(!v)return!1;if(e.pieces.delete(o),l&&p){e.pieces.delete(p);const t="man"===v.role&&"russian"===m,o="white"===i.color?1:e.boardSize[1];let r=!1;for(let n=2;n+4<=l.length;n+=2){const i=c(l.slice(n,n+2),s),a=c(l.slice(n+2,n+4),s),d=W(e.pieces,s,i[0],i[1],a[0],a[1]);d&&e.pieces.delete(d),t&&i[1]===o&&(r=!0)}r&&(v.role="king"),e.pieces.set(n,v)}else if(e.pieces.set(n,v),p){const o=e.pieces.get(p);if(o){const n=o.color,i=o.role;if(e.pieces.delete(p),!r&&void 0!==e.movable.captLen&&e.movable.captLen>1)"man"===i?e.pieces.set(p,{role:"ghostman",color:n}):"king"===i&&e.pieces.set(p,{role:"ghostking",color:n});else for(let o=0;o<t.length;o++){const n=t[o],r=e.pieces.get(n);!r||"ghostking"!==r.role&&"ghostman"!==r.role||e.pieces.delete(n)}}}return e.lastMove&&e.lastMove.length&&a&&e.lastMove[e.lastMove.length-1]===o?(e.animateFrom=e.lastMove.length-1,l?e.lastMove=e.lastMove.concat(O(l.slice(2))):e.lastMove.push(n)):(e.animateFrom=0,e.lastMove=l?O(l):[o,n]),E(e.events.change),g||!0}function F(e,t,o,n){if(e.pieces.has(o)){if(!n)return!1;e.pieces.delete(o)}return E(e.events.dropNewPiece,t,o),e.pieces.set(o,t),e.lastMove=[o],E(e.events.change),e.movable.dests=void 0,e.turnColor=u(e.turnColor),!0}function I(e,t,o){const n=q(e,t,o);return n&&(e.movable.dests=void 0,(!e.movable.captLen||e.movable.captLen<=1)&&(e.turnColor=u(e.turnColor)),e.animation.current=void 0),n}function R(e,t,o){if(H(e,t,o)){const n=I(e,t,o);if(n){const r=e.hold.stop();U(e);const i={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:r};return!0!==n&&(i.captured=n),E(e.movable.events.after,t,o,i),!0}}else if(function(e,t,o){return t!==o&&_(e,t)&&p(K(e.pieces,e.boardSize,t,e.premovable.variant),o)}(e,t,o))return function(e,t,o,n){D(e),e.premovable.current=[t,o],E(e.premovable.events.set,t,o,n)}(e,t,o,{ctrlKey:e.stats.ctrlKey}),U(e),!0;return U(e),!1}function B(e,t,o,n){const r=e.pieces.get(t);r&&(function(e,t,o){const n=e.pieces.get(t);return!!n&&o&&(t===o||!e.pieces.has(o))&&("both"===e.movable.color||e.movable.color===n.color&&e.turnColor===n.color)}(e,t,o)||n)?(e.pieces.delete(t),F(e,r,o,n),E(e.movable.events.afterNewPiece,r.role,o,{predrop:!1})):r&&function(e,t,o){const n=e.pieces.get(t),r=e.pieces.get(o);return!!n&&(!r||r.color!==e.movable.color)&&e.predroppable.enabled&&e.movable.color===n.color&&e.turnColor!==n.color}(e,t,o)?function(e,t,o){A(e),e.predroppable.current={role:t,key:o},E(e.predroppable.events.set,t,o)}(e,r.role,o):(A(e),D(e)),e.pieces.delete(t),U(e)}function T(e,t,o){if(E(e.events.select,t),e.selected){if(e.selected===t&&!e.draggable.enabled)return U(e),void e.hold.cancel();if((e.selectable.enabled||o)&&e.selected!==t&&R(e,e.selected,t)){e.stats.dragged=!1;const o=e.animateFrom?e.animateFrom+1:1;return void(void 0!==e.movable.captLen&&e.movable.captLen>(e.lastMove?e.lastMove.length-o:1)&&$(e,t))}}(j(e,t)||_(e,t))&&($(e,t),e.hold.start())}function $(e,t){e.selected=t,_(e,t)?e.premovable.dests=K(e.pieces,e.boardSize,t,e.premovable.variant):e.premovable.dests=void 0}function U(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function j(e,t){const o=e.pieces.get(t);return!!o&&("both"===e.movable.color||e.movable.color===o.color&&e.turnColor===o.color)}function H(e,t,o){return t!==o&&j(e,t)&&(e.movable.free||!!e.movable.dests&&p(e.movable.dests.get(t),o))}function _(e,t){const o=e.pieces.get(t);return!!o&&e.premovable.enabled&&e.movable.color===o.color&&e.turnColor!==o.color}function G(e){const t=e.premovable.current;if(!t)return!1;const o=t[0],n=t[1];let r=!1;if(H(e,o,n)){const t=I(e,o,n);if(t){const i={premove:!0};!0!==t&&(i.captured=t),E(e.movable.events.after,o,n,i),r=!0}}return A(e),r}function Z(e){A(e),D(e),U(e)}function X(e){e.movable.color=e.movable.dests=e.animation.current=void 0,Z(e)}function Y(e,t,o,n){let r=Math.ceil(t[1]*((e[1]-n.top)/n.height));o||(r=t[1]+1-r);let i=Math.ceil(t[0]*((e[0]-n.left)/n.width));if(o||(i=t[0]+1-i),r%2!=0){if(i%2!=0)return;i/=2}else{if(i%2==0)return;i=(i+1)/2}return i>0&&i<=t[0]/2&&r>0&&r<=t[1]?a([i,r],t):void 0}function Q(e,t,o,n){let r=Math.ceil(t[1]*((e[1]-n.top)/n.height));o||(r=t[1]+1-r);let i=Math.ceil(t[0]*((e[0]-n.left)/n.width));if(o||(i=t[0]+1-i),r%2!=0){if(i%2!=0)return!0}else if(i%2==0)return!0;return!1}function V(e){return e.boardSize[0]*e.boardSize[1]/2}function J(e){return"white"===e.orientation}const ee="W31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50:B1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20";function te(e,t){const n=new Map;if(!e)return n;"start"===e&&(e=ee);for(let r of e.split(":")){if(r.length<=1)continue;let e,i=r.slice(0,1);if("W"===i.toUpperCase())e="white";else{if("B"!==i.toUpperCase())continue;e="black"}const a=r.slice(1).split(",");for(let r of a){if(!r)continue;let i,a;switch(r.slice(0,1)){case"K":a="king",i=r.slice(1);break;case"G":a="ghostman",i=r.slice(1);break;case"P":a="ghostking",i=r.slice(1);break;default:a="man",i=r}1===i.length&&(i="0"+i);let s=parseInt(i);s||(s=o.indexOf(i)+1),s&&(!t||s<=t)&&n.set(i,{color:e,role:a})}}return n}function oe(e,t){if(t.movable&&t.movable.dests&&(e.movable.dests=void 0),t.movable&&t.movable.captureUci&&(e.movable.captureUci=void 0),re(e,t),t.fen&&(e.pieces=te(t.fen,V(e)),e.drawable.shapes=[],e.highlight&&e.highlight.kingMoves)){const o=function(e){if(!e)return;"start"===e&&(e=ee);const t=e.split(":"),o=t.length?t[t.length-1]:"";if(0!==o.indexOf("+"))return;const n=o.split("+").filter((function(e){return 0!=e.length}));if(2!==n.length)return;const r=parseInt(n[1].slice(0,1)),i=parseInt(n[0].slice(0,1)),a={white:{count:r},black:{count:i}};return r>0&&(a.white.key=n[1].slice(1)),i>0&&(a.black.key=n[0].slice(1)),a}(t.fen);o&&ne(e,o)}t.hasOwnProperty("lastMove")&&!t.lastMove?(e.lastMove=void 0,e.animateFrom=void 0):t.lastMove&&(e.lastMove=t.lastMove,e.animateFrom=void 0),void 0!==t.captureLength&&(e.movable.captLen=t.captureLength),e.selected&&$(e,e.selected),(!e.animation.duration||e.animation.duration<100)&&(e.animation.enabled=!1)}function ne(e,t){if(t.white.count>0&&t.white.key){const o=e.pieces.get(t.white.key);o&&"king"===o.role&&"white"===o.color&&(o.kingMoves=t.white.count)}if(t.black.count>0&&t.black.key){const o=e.pieces.get(t.black.key);o&&"king"===o.role&&"black"===o.color&&(o.kingMoves=t.black.count)}}function re(e,t){for(let o in t)ie(e[o])&&ie(t[o])?re(e[o],t[o]):e[o]=t[o]}function ie(e){return"object"==typeof e}function ae(e,o,n=!1,r=!1){return o.animation.enabled?function(e,o,n=!1,r=!1){const i=new Map(o.pieces),a=e(o),s=function(e,o,n=!1,r=!1){let i=[],a=[],s=[],l=[];const d=new Map,u={},p=o.boardSize,h=o.movable&&o.movable.variant||o.premovable&&o.premovable.variant;let m,b,v,w=0;for(const[t,c]of e)d.set(t,ce(t,p,c)),"ghostman"!==c.role&&"ghostking"!==c.role||w++;for(const c of t)m=o.pieces.get(c),b=d.get(c),m?b?f(m,b.piece)||("white"===b.piece.color?i.push(b):a.push(b),"white"===m.color?s.push(ce(c,p,m)):l.push(ce(c,p,m))):"white"===m.color?s.push(ce(c,p,m)):l.push(ce(c,p,m)):b&&("white"===b.piece.color?i.push(b):a.push(b));const k={anims:new Map,captures:new Map,tempRole:new Map,fadings:new Map};let y={anims:new Map,captures:new Map,tempRole:new Map,fadings:new Map};s.length>1&&i.length>0&&(s=s.sort(((e,t)=>g(i[0].pos,e.pos)-g(i[0].pos,t.pos))));l.length>1&&a.length>0&&(l=l.sort(((e,t)=>g(a[0].pos,e.pos)-g(a[0].pos,t.pos))));const M=!r&&(0===w||o.animateFrom)&&o.lastMove&&o.lastMove.length>2,S=o.animateFrom||0;if(!n&&M&&o.lastMove&&o.lastMove[S]===o.lastMove[o.lastMove.length-1]){const e=o.lastMove[S];m=o.pieces.get(e),b=d.get(e),m&&b&&"white"===m.color&&0!==a.length?(i.push(b),s.push(ce(e,p,m))):m&&b&&"black"===m.color&&0!==i.length&&(a.push(b),l.push(ce(e,p,m)))}let z=i.concat(a),C=s.concat(l);C.length&&z.length&&!n&&C.forEach((t=>{let n=!1,r=z.filter((e=>!u[e.key]&&t.piece.color===e.piece.color&&(t.piece.role===e.piece.role||"man"===e.piece.role&&"king"===t.piece.role&&de(t.piece.color,t.pos,p)||"king"===e.piece.role&&"man"===t.piece.role&&de(e.piece.color,e.pos,p))));var i;if(r.length||"russian"!==h||(n=!0,r=z.filter((e=>!u[e.key]&&t.piece.color===e.piece.color&&("man"===e.piece.role&&"king"===t.piece.role||"king"===e.piece.role&&"man"===t.piece.role)))),i=t,b=r.sort(((e,t)=>g(i.pos,e.pos)-g(i.pos,t.pos)))[0],b){u[b.key]=!0;let r="man"===b.piece.role&&"king"===t.piece.role&&(n||de(t.piece.color,t.pos,p))?"man":void 0;if(M&&o.lastMove&&o.lastMove[S]===b.key&&o.lastMove[o.lastMove.length-1]===t.key){let n,i=c(o.lastMove[S+1],p);k.anims.set(t.key,ue(b.pos,i)),k.nextPlan=y,r&&k.tempRole.set(t.key,r);const a=new Array;let s=W(e,p,b.pos[0],b.pos[1],i[0],i[1]);if(s){const t=e.get(s);t&&(a.push(s),e.set(s,le(t)))}k.captures=new Map,z.forEach((e=>{e.piece.color!==t.piece.color&&(-1!==a.indexOf(e.key)?k.captures.set(e.key,le(e.piece)):k.captures.set(e.key,e.piece))}));let l={anims:new Map,captures:new Map,tempRole:new Map,fadings:new Map};for(v=S+2;v<o.lastMove.length;v++){n=c(o.lastMove[v],p);const d=ue(i,n);if(d[2]=i[0]-t.pos[0],d[3]=i[1]-t.pos[1],y.anims.set(t.key,d),y.nextPlan=l,r&&("russian"===h&&de(t.piece.color,i,p)?r=void 0:y.tempRole.set(t.key,r)),s=W(e,p,i[0],i[1],n[0],n[1]),s){const t=e.get(s);t&&(a.push(s),e.set(s,le(t)))}y.captures=new Map,z.forEach((e=>{e.piece.color!==t.piece.color&&(-1!==a.indexOf(e.key)?y.captures.set(e.key,le(e.piece)):y.captures.set(e.key,e.piece))})),i=n,y=l,l={anims:new Map,captures:new Map,tempRole:new Map,fadings:new Map}}}else k.anims.set(t.key,ue(b.pos,t.pos)),r&&k.tempRole.set(t.key,r)}}));return k}(i,o,n,r);if(S(s.anims))o.animation.current&&!function(e,t){if(!e&&!t)return!0;if(!e||!t||e.length!==t.length)return!1;for(let o=0;o<e.length;o++)if(e[o]!==t[o])return!1;return!0}(o.animation.current.lastMove,o.lastMove)&&(o.animation.current=void 0),o.dom.redraw();else{const e=o.animation.current&&o.animation.current.start;o.animation.current={start:performance.now(),frequency:(s.nextPlan&&!S(s.nextPlan.anims)?2.2:1)/o.animation.duration,plan:s,lastMove:o.lastMove},e||pe(o,performance.now())}return a}(e,o,n,r):se(e,o)}function se(e,t){const o=e(t);return t.dom.redraw(),o}function ce(e,t,o){return{key:e,pos:c(e,t),piece:o}}function le(e){return"man"===e.role?{role:"ghostman",color:e.color,promoted:e.promoted,kingMoves:e.kingMoves}:"king"===e.role?{role:"ghostking",color:e.color,promoted:e.promoted,kingMoves:e.kingMoves}:{role:e.role,color:e.color,promoted:e.promoted,kingMoves:e.kingMoves}}function de(e,t,o){return"white"===e&&1===t[1]||"black"===e&&t[1]===o[1]}function ue(e,t){return e[1]%2==0&&t[1]%2==0?[e[0]-t[0],e[1]-t[1],0,0,-.5]:e[1]%2!=0&&t[1]%2==0?[e[0]-t[0]+.5,e[1]-t[1],0,0,-.5]:e[1]%2==0&&t[1]%2!=0?[e[0]-t[0]-.5,e[1]-t[1],0,0,0]:[e[0]-t[0],e[1]-t[1],0,0,0]}function pe(e,t){let o=e.animation.current;if(void 0===o)return void(e.dom.destroyed||e.dom.redrawNow());let n=1-(t-o.start)*o.frequency;if(n<=0&&(o.plan.nextPlan&&!S(o.plan.nextPlan.anims)?(e.animation.current={start:performance.now(),frequency:2.2/e.animation.duration,plan:o.plan.nextPlan,lastMove:e.lastMove},o=e.animation.current,n=1-(performance.now()-o.start)*o.frequency):e.animation.current=void 0),void 0!==e.animation.current){n>.999&&(n=.999);const t=(r=n)<.5?4*r*r*r:(r-1)*(2*r-2)*(2*r-2)+1;for(const[e,n]of o.plan.anims)n[2]=n[0]*t,n[3]=n[1]*t;e.dom.redrawNow(!0),requestAnimationFrame(((t=performance.now())=>pe(e,t)))}else e.dom.redrawNow();var r}const ge=["green","red","blue","yellow"];function fe(e,t){if(t.touches&&t.touches.length>1)return;t.stopPropagation(),t.preventDefault(),t.ctrlKey?U(e):Z(e);const o=k(t),n=Y(o,e.boardSize,J(e),e.dom.bounds());n&&(e.drawable.current={orig:n,pos:o,brush:we(t)},he(e))}function he(e){requestAnimationFrame((()=>{const t=e.drawable.current;if(t){const o=Y(t.pos,e.boardSize,J(e),e.dom.bounds());o!==t.mouseSq&&(o?(t.mouseSq=o,t.prev=void 0,t.dest=o!==t.orig?o:void 0):(t.prev=t.mouseSq,t.mouseSq=void 0),e.dom.redrawNow()),he(e)}}))}function me(e,t){e.drawable.current&&(e.drawable.current.pos=k(t))}function be(e){const t=e.drawable.current;t&&(t.mouseSq&&function(e,t){const o=e=>e.orig===t.orig&&e.dest===t.dest,n=e.shapes.filter(o)[0];n&&(e.shapes=e.shapes.filter((e=>!o(e))));n&&n.brush===t.brush||e.shapes.push(t);ke(e)}(e.drawable,t),ve(e))}function ve(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function we(e){return ge[((e.shiftKey||e.ctrlKey)&&y(e)?1:0)+(e.altKey?2:0)]}function ke(e){e.onChange&&e.onChange(e.shapes)}function ye(e){const t=J(e),o=e.boardSize,n=e.dom.relative?(S=o,(e,t,o)=>h(e,S,t,200/S[0],100/S[1],o)):m(e.dom.bounds(),o),r=e.dom.relative?v:b,i=e.dom.elements.board,a=e.pieces,s=e.animation.current,l=s?s.plan.anims:new Map,d=s?s.plan.captures:new Map,u=s?s.plan.tempRole:new Map,p=e.draggable.current,g=function(e){const t={};let o,n;if(e.lastMove&&e.highlight.lastMove)for(o in e.lastMove)e.lastMove[o]!==e.selected&&Le(t,e.lastMove[o],"last-move");if(e.selected&&(Le(t,e.selected,"selected"),e.movable.showDests)){const r=e.movable.dests&&e.movable.dests.get(e.selected);if(r)for(o in r)n=r[o],Le(t,n,"move-dest"+(e.pieces.has(n)?" oc":""));const i=e.premovable.dests;if(i)for(o in i)n=i[o],Le(t,n,"premove-dest"+(e.pieces.has(n)?" oc":""))}const r=e.premovable.current;if(r)for(o in r)Le(t,r[o],"current-premove");else e.predroppable.current&&Le(t,e.predroppable.current.key,"current-premove");const i=e.exploding;if(i)for(o in i.keys)Le(t,i.keys[o],"exploding"+i.stage);return t}(e),f={},w={},k=new Map,y=new Map;var S;let z,C,P,x,L,N,K,O,E,A,D,W=s&&s.lastMove&&s.lastMove.length>2&&s.lastMove[0]===s.lastMove[s.lastMove.length-1]?s.lastMove[0]:void 0;for(C=i.firstChild;C;){if(z=C.cgKey,Me(C))if(P=a.get(z),L=l.get(z),N=d.get(z),K=u.get(z),x=C.cgPiece,!C.cgDragging||p&&p.orig===z||(C.classList.remove("dragging"),r(C,n(c(z,o),t,0)),C.cgDragging=!1),C.classList.contains("temporary")&&N){const e=xe(N)+" temporary";x!==e&&(C.className=e),f[z]=!0}else if(P){if(L&&C.cgAnimating&&x===xe(P)){W=void 0;const e=c(z,o);if(e[0]+=L[2],e[1]+=L[3],s&&s.plan.nextPlan){const t=s.plan.nextPlan.anims.get(z);t&&(e[0]+=t[2],e[1]+=t[3])}C.classList.add("anim"),K?(C.className=C.className.replace(P.role,K),C.classList.add("temprole")):C.classList.contains("temprole")&&(C.classList.remove("temprole"),"king"===P.role?C.className=C.className.replace("man","king"):"man"===P.role&&(C.className=C.className.replace("king","man"))),r(C,n(e,t,L[4]))}else C.cgAnimating&&(C.cgAnimating=!1,C.classList.remove("anim"),C.classList.contains("temprole")&&(C.classList.remove("temprole"),"king"===P.role?C.className=C.className.replace("man","king"):"man"===P.role&&(C.className=C.className.replace("king","man"))),r(C,n(c(z,o),t,0)),e.addPieceZIndex&&(C.style.zIndex=Pe(c(z,o),t)));x===xe(P)&&z!==W?f[z]=!0:Ne(k,x,C)}else Ne(k,x,C);else if(Se(C)){const e=C.className;g[z]===e?w[z]=!0:Ne(y,e,C)}C=C.nextSibling}for(const h in g)if(!w[h]){A=y.get(g[h]),D=A&&A.pop();const e=n(c(h,o),t,0);if(D)D.cgKey=h,r(D,e);else{const t=M("square",g[h]);t.cgKey=h,r(t,e),i.insertBefore(t,i.firstChild)}}for(const[h,m]of a)if(L=l.get(h),N=d.get(h),K=u&&u.get(h),!f[h]&&!N)if(O=k.get(xe(m)),E=O&&O.pop(),E){E.cgKey=h;const i=c(h,o);let a;if(e.addPieceZIndex&&(E.style.zIndex=Pe(i,t)),L){if(E.cgAnimating=!0,E.classList.add("anim"),i[0]+=L[2],i[1]+=L[3],a=L[4],s&&s.plan.nextPlan){const e=s.plan.nextPlan.anims.get(h);e&&(i[0]+=e[2],i[1]+=e[3])}}else a=0;r(E,n(i,t,a))}else{const a=xe(m),s=M("piece",a),l=c(h,o);let d;s.cgPiece=a,s.cgKey=h,L?(s.cgAnimating=!0,l[0]+=L[2],l[1]+=L[3],d=L[4],K&&(s.className=s.className.replace(m.role,K),s.classList.add("temprole"))):d=0,r(s,n(l,t,d)),e.addPieceZIndex&&(s.style.zIndex=Pe(l,t)),i.appendChild(s)}for(const h in d)if(z=h,N=d.get(z),N&&!f[z]){const a=xe(N)+" temporary",s=M("piece",a),l=c(z,o);s.cgPiece=a,s.cgKey=z,r(s,n(l,t,0)),e.addPieceZIndex&&(s.style.zIndex=Pe(l,t)),i.appendChild(s)}for(const c of k.values())Ce(e,c);for(const c of y.values())Ce(e,c)}function Me(e){return"PIECE"===e.tagName}function Se(e){return"SQUARE"===e.tagName}function ze(e){return"FIELDNUMBER"===e.tagName}function Ce(e,t){for(const o in t)e.dom.elements.board.removeChild(t[o])}function Pe(e,t){let o=2+8*(e[1]-1)+(8-e[0]);return t&&(o=67-o),o+""}function xe(e){return"ghostman"===e.role?`${e.color} man ghost`:"ghostking"===e.role?e.kingMoves&&e.kingMoves>0?`${e.color} king ghost king${e.kingMoves}`:`${e.color} king ghost`:"king"===e.role&&e.kingMoves&&e.kingMoves>0?`${e.color} king king${e.kingMoves}`:`${e.color} ${e.role}`}function Le(e,t,o){e[t]?e[t]+=" "+o:e[t]=o}function Ne(e,t,o){const n=e.get(t);n?n.push(o):e.set(t,[o])}function Ke(e,t){if(!t.isTrusted||void 0!==t.button&&0!==t.button)return;if(t.touches&&t.touches.length>1)return;const o=e.dom.bounds(),n=e.boardSize,r=k(t),i=Y(r,n,J(e),o),a=!i&&Q(r,n,J(e),o);if(!i&&!a)return;const s=i&&e.pieces.get(i),l=e.selected;var d;if(l||!e.drawable.enabled||!e.drawable.eraseOnClick&&s&&s.color===e.turnColor||(d=e).drawable.shapes.length&&(d.drawable.shapes=[],d.dom.redraw(),ke(d.drawable)),!1===t.cancelable||t.touches&&e.movable.color&&!s&&!l&&!function(e,t){const o=J(e),n=e.dom.bounds(),r=Math.pow(n.width/10,2);for(let i in e.pieces){const a=qe(i,e.boardSize,o,n),s=[a.left+a.width/2,a.top+a.height/2];if(g(s,t)<=r)return!0}return!1}(e,r)||t.preventDefault(),!i)return;const u=!!e.premovable.current,p=!!e.predroppable.current;e.stats.ctrlKey=t.ctrlKey,e.selected&&H(e,e.selected,i)?ae((e=>T(e,i)),e):T(e,i);const f=e.selected===i,h=Fe(e,i);if(s&&h&&f&&function(e,t){const o=e.pieces.get(t);return!!o&&e.draggable.enabled&&("both"===e.movable.color||e.movable.color===o.color&&(e.turnColor===o.color||e.premovable.enabled))}(e,i)){const a=qe(i,n,J(e),o);e.draggable.current={orig:i,origPos:c(i,n),piece:s,rel:r,epos:r,pos:[0,0],dec:e.draggable.centerPiece?[r[0]-(a.left+a.width/2),r[1]-(a.top+a.height/2)]:[0,0],started:e.draggable.autoDistance&&e.stats.dragged,element:h,previouslySelected:l,originTarget:t.target},h.cgDragging=!0,h.classList.add("dragging");const d=e.dom.elements.ghost;d&&(d.className="ghost "+xe(s),b(d,m(o,n)(c(i,n),J(e),0))),Oe(e)}else u&&A(e),p&&D(e);e.dom.redraw()}function Oe(e){requestAnimationFrame((()=>{const t=e.draggable.current;if(!t)return;e.animation.current&&e.animation.current.plan.anims.has(t.orig)&&(e.animation.current=void 0);const o=e.pieces.get(t.orig);if(o&&f(o,t.piece)){if(!t.started&&g(t.epos,t.rel)>=Math.pow(e.draggable.distance,2)&&(t.started=!0),t.started){if("function"==typeof t.element){const e=t.element();if(!e)return;e.cgDragging=!0,e.classList.add("dragging"),t.element=e}t.pos=[t.epos[0]-t.rel[0],t.epos[1]-t.rel[1]];const o=m(e.dom.bounds(),e.boardSize)(t.origPos,J(e),0);o[0]+=t.pos[0]+t.dec[0],o[1]+=t.pos[1]+t.dec[1],b(t.element,o)}}else De(e);Oe(e)}))}function Ee(e,t){e.draggable.current&&(!t.touches||t.touches.length<2)&&(e.draggable.current.epos=k(t))}function Ae(e,t){const o=e.draggable.current;if(!o)return;if("touchend"===t.type&&!1!==t.cancelable&&t.preventDefault(),"touchend"===t.type&&o&&o.originTarget!==t.target&&!o.newPiece)return void(e.draggable.current=void 0);A(e),D(e);const n=k(t)||o.epos,r=Y(n,e.boardSize,J(e),e.dom.bounds()),i=!r&&Q(n,e.boardSize,J(e),e.dom.bounds()),a=o.started&&o.orig!==r;if(r&&a){if(o.newPiece)B(e,o.orig,r,o.force);else if(e.stats.ctrlKey=t.ctrlKey,ae((e=>R(e,o.orig,r)),e,!0)){e.stats.dragged=!0;const t=e.animateFrom?e.animateFrom+1:1;e.movable.captLen&&e.movable.captLen>(e.lastMove?e.lastMove.length-t:1)&&$(e,r)}}else o.newPiece?e.pieces.delete(o.orig):i&&a?U(e):e.draggable.deleteOnDropOff&&!r&&(e.pieces.delete(o.orig),E(e.events.change));(!o||o.orig!==o.previouslySelected||o.orig!==r&&r)&&e.selectable.enabled||U(e),We(e),e.draggable.current=void 0,e.dom.redraw()}function De(e){const t=e.draggable.current;t&&(t.newPiece&&e.pieces.delete(t.orig),e.draggable.current=void 0,U(e),We(e),e.dom.redraw())}function We(e){const t=e.dom.elements;t.ghost&&w(t.ghost)}function qe(e,t,o,n){const r=c(e,t),i=t[0],a=t[1];return o||(r[0]=i/2+1-r[0],r[1]=a+1-r[1]),{left:n.left+n.width*(2*(r[0]-1)+(r[1]%2!=0?1:0))/i,top:n.top+n.height*(r[1]-1)/a,width:n.width/i,height:n.height/a}}function Fe(e,t){let o=e.dom.elements.board.firstChild;for(;o;){if(o.cgKey===t&&"PIECE"===o.tagName)return o;o=o.nextSibling}}function Ie(e,t){e.exploding&&(t?e.exploding.stage=t:e.exploding=void 0,e.dom.redraw())}function Re(e,n){function r(){!function(e){e.orientation=u(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0}(e),n()}return{set(t,o=!1){t.orientation&&t.orientation!==e.orientation&&r(),t.fen?(ae((e=>oe(e,t)),e,!1,o),e.selected&&!e.pieces.get(e.selected)&&(e.selected=void 0)):se((e=>oe(e,t)),e)},state:e,getFen:n=>function(e,n,r){const i=n||50;let a="W",s="B";for(let c=1;c<=i;c++){const n=t[c-1],i=e.get(n);i&&("white"===i.color?(a.length>1&&(a+=","),"king"===i.role?a+="K":"ghostman"===i.role?a+="G":"ghostking"===i.role&&(a+="P"),a+=r?o[c-1]:c.toString()):(s.length>1&&(s+=","),"king"===i.role?s+="K":"ghostman"===i.role?s+="G":"ghostking"===i.role&&(s+="P"),s+=r?o[c-1]:c.toString()))}return a+":"+s}(e.pieces,V(e),n),toggleOrientation:r,setPieces(t){ae((e=>function(e,t){for(const[o,n]of t)n?e.pieces.set(o,n):e.pieces.delete(o)}(e,t)),e)},selectSquare(t,o){t?ae((e=>T(e,t,o)),e):e.selected&&(U(e),e.dom.redraw())},move(t,o,n){ae((e=>q(e,t,o,n)),e)},newPiece(t,o){ae((e=>F(e,t,o)),e)},setKingMoves(t){!function(e,t){const o=V(e);for(let n=1;n<=o;n++){const t=n<10?"0"+n.toString():n.toString(),o=e.pieces.get(t);o&&o.kingMoves&&(o.kingMoves=void 0)}ne(e,t)}(e,t)},playPremove(){if(e.premovable.current){const t=e.premovable.current?e.premovable.current[1]:"00";if(ae(G,e))return e.movable.captLen&&e.movable.captLen>1&&$(e,t),!0;e.dom.redraw()}return!1},playPredrop(t){if(e.predroppable.current){const o=function(e,t){let o=e.predroppable.current,n=!1;if(!o)return!1;t(o)&&F(e,{role:o.role,color:e.movable.color},o.key)&&(E(e.movable.events.afterNewPiece,o.role,o.key,{predrop:!0}),n=!0);return D(e),n}(e,t);return e.dom.redraw(),o}return!1},cancelPremove(){se(A,e)},cancelPredrop(){se(D,e)},cancelMove(){se((e=>{Z(e),De(e)}),e)},stop(){se((e=>{X(e),De(e)}),e)},explode(t){!function(e,t){e.exploding={stage:1,keys:t},e.dom.redraw(),setTimeout((()=>{Ie(e,2),setTimeout((()=>Ie(e,void 0)),120)}),120)}(e,t)},setAutoShapes(t){se((e=>e.drawable.autoShapes=t),e)},setShapes(t){se((e=>e.drawable.shapes=t),e)},getKeyAtDomPos:t=>Y(t,e.boardSize,J(e),e.dom.bounds()),redrawAll:n,dragNewPiece(t,o,n){!function(e,t,o,n){const r="00";e.pieces.set(r,t),e.dom.redraw();const i=k(o),a=J(e),s=e.dom.bounds(),l=qe(r,e.boardSize,a,s),d=[(a?-1:e.boardSize[0])*l.width+s.left,(a?0:e.boardSize[1]-1)*l.height+s.top];e.draggable.current={orig:r,origPos:c(r,e.boardSize),piece:t,rel:d,epos:i,pos:[i[0]-d[0],i[1]-d[1]],dec:[-l.width/2,-l.height/2],started:!0,element:()=>Fe(e,r),originTarget:o.target,newPiece:!0,force:!!n},Oe(e)}(e,t,o,n)},destroy(){X(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}function Be(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function Te(e,t){const o=e.drawable,n=o.current,r=n&&(n.mouseSq||n.prev)?n:void 0,i={},a=e.dom.bounds();o.shapes.concat(o.autoShapes).concat(r?[r]:[]).forEach((e=>{e.dest&&(i[e.dest]=(i[e.dest]||0)+1)}));const s=o.shapes.concat(o.autoShapes).map((e=>({shape:e,current:!1,hash:$e(e,i,!1,a)})));r&&s.push({shape:r,current:!0,hash:$e(r,i,!0,a)});const l=s.map((e=>e.hash)).join("");if(l===e.drawable.prevSvgHash)return;e.drawable.prevSvgHash=l;const d=t.firstChild;!function(e,t,o){const n={};let r;t.forEach((t=>{t.shape.dest&&(r=e.brushes[t.shape.brush],t.shape.modifiers&&(r=Ge(r,t.shape.modifiers)),n[r.key]=r)}));const i={};let a=o.firstChild;for(;a;)i[a.getAttribute("cgKey")]=!0,a=a.nextSibling;for(let s in n)i[s]||o.appendChild(je(n[s]))}(o,s,d),function(e,t,o,n,r,i){const a=e.dom.bounds(),s={},l=[];t.forEach((e=>{s[e.hash]=!1}));let d,u=i.nextSibling;for(;u;)d=u.getAttribute("cgHash"),s.hasOwnProperty(d)?s[d]=!0:l.push(u),u=u.nextSibling;l.forEach((e=>r.removeChild(e))),t.forEach((t=>{s[t.hash]||r.appendChild(function(e,{shape:t,current:o,hash:n},r,i,a,s){let l;if(t.piece)l=function(e,t,o,n,r){const i=Ye(t,n,r),a=n.width/r[0]*(o.scale||1),s=o.color[0]+o.role[0].toUpperCase();return He(Be("image"),{className:`${o.role} ${o.color}`,x:i[0]-a/2,y:i[1]-a/2,width:a,height:a,href:e+s+".svg"})}(e.drawable.pieces.baseUrl,_e(c(t.orig,e.boardSize),e.orientation,s),t.piece,a,s);else{const n=_e(c(t.orig,e.boardSize),e.orientation,s);if(t.orig&&t.dest){let d=r[t.brush];t.modifiers&&(d=Ge(d,t.modifiers)),l=function(e,t,o,n,r,i,a){const s=function(e,t,o){return o[0]*(t?2:1)/512*e.width}(i,r&&!n,a),c=Ye(t,i,a),l=Ye(o,i,a),d=l[0]-c[0],u=l[1]-c[1],p=Math.atan2(u,d),g=Math.cos(p)*s,f=Math.sin(p)*s;return He(Be("line"),{stroke:e.color,"stroke-width":Ze(e,n,i,a),"stroke-linecap":"round","marker-end":"url(#arrowhead-"+e.key+")",opacity:Xe(e,n),x1:c[0],y1:c[1],x2:l[0]-g,y2:l[1]-f})}(d,n,_e(c(t.dest,e.boardSize),e.orientation,s),o,i[t.dest]>1,a,s)}else l=function(e,t,o,n,r){const i=Ye(t,n,r),a=function(e,t){const o=512*t[0]/10,n=e.width/o;return[3*n,4*n]}(n,r),s=(n.width+n.height)/(2*(r[0]+r[1]));return He(Be("circle"),{stroke:e.color,"stroke-width":a[o?0:1],fill:"none",opacity:Xe(e,o),cx:i[0],cy:i[1],r:s-a[1]/2})}(r[t.brush],n,o,a,s)}return l.setAttribute("cgHash",n),l}(e,t,o,n,a,e.boardSize))}))}(e,s,o.brushes,i,t,d)}function $e({orig:e,dest:t,brush:o,piece:n,modifiers:r},i,a,s){return[s.width,s.height,a,e,t,o,t&&i[t]>1,n&&Ue(n),r&&(c=r,""+(c.lineWidth||""))].filter((e=>e)).join(",");var c}function Ue(e){return[e.color,e.role,e.scale].filter((e=>e)).join(",")}function je(e){const t=He(Be("marker"),{id:"arrowhead-"+e.key,orient:"auto",markerWidth:4,markerHeight:8,refX:2.05,refY:2.01});return t.appendChild(He(Be("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),t.setAttribute("cgKey",e.key),t}function He(e,t){for(let o in t)e.setAttribute(o,t[o]);return e}function _e(e,t,o){return"white"===t?e:[o[0]/2+1-e[0],o[1]+1-e[1]]}function Ge(e,t){const o={color:e.color,opacity:Math.round(10*e.opacity)/10,lineWidth:Math.round(t.lineWidth||e.lineWidth)};return o.key=[e.key,t.lineWidth].filter((e=>e)).join(""),o}function Ze(e,t,o,n){const r=512*n[0]/10;return(e.lineWidth||10)*(t?.85:1)/r*o.width}function Xe(e,t){return(e.opacity||1)*(t?.9:1)}function Ye(e,t,o){return[(2*e[0]-(e[1]%2!=0?.5:1.5))*t.width/o[0],(e[1]-.5)*t.height/o[1]]}function Qe(o,a,s){o.innerHTML="",o.classList.add("cg-wrap"),e.forEach((e=>o.classList.toggle("orientation-"+e,a.orientation===e))),o.classList.toggle("manipulable",!a.viewOnly);const l=M("cg-helper");o.appendChild(l);const d=M("cg-container");l.appendChild(d);const u=M("cg-board");let p,g;if(d.appendChild(u),a.drawable.visible&&!s&&(p=Be("svg"),p.appendChild(Be("defs")),d.appendChild(p)),a.coordinates)if(2===a.coordinates)if(8===a.boardSize[0]&&8===a.boardSize[1])d.appendChild(Ve(r,"ranks is64"+("black"===a.orientation?" black":" white"))),d.appendChild(Ve(i,"files is64"+("black"===a.orientation?" black":" white")));else if("black"===a.orientation){const e=[],t=[],o=a.boardSize[0]/2,n=a.boardSize[1]/2;for(let r=1;r<=o;r++)e.push(r);for(let r=0;r<n;r++)t.push(o+a.boardSize[0]*r+1);d.appendChild(Ve(t,"ranks is100 black")),d.appendChild(Ve(e,"files is100 black"))}else{const e=[],t=[],o=a.boardSize[0]/2,n=a.boardSize[0]*a.boardSize[1]/2,r=a.boardSize[1]/2;for(let i=n-o+1;i<=n;i++)e.push(i);for(let i=0;i<r;i++)t.push(o+a.boardSize[0]*i);d.appendChild(Ve(t,"ranks is100")),d.appendChild(Ve(e,"files is100"))}else 8===a.boardSize[0]&&8===a.boardSize[1]?(d.appendChild(Ve(r,"ranks is64"+("black"===a.orientation?" black":" white"))),d.appendChild(Ve(i,"files is64"+("black"===a.orientation?" black":" white")))):s||1!==a.coordinates||function(e,o,r){const i="black"!==o.orientation,a=V(o);for(let s=1;s<=a;s++){const a=M("fieldnumber","black"),l=s.toString(),d=t[s-1];a.textContent=1===o.coordSystem?n[l]:l,a.cgKey=d;const u=m(r,o.boardSize)(c(d,o.boardSize),i,0);b(a,[u[0],u[1]]),e.appendChild(a)}}(u,a,u.getBoundingClientRect());return a.draggable.showGhost&&!s&&(g=M("piece","ghost"),w(g),d.appendChild(g)),{board:u,container:d,ghost:g,svg:p}}function Ve(e,t){const o=M("coords",t);let n;for(let r in e)n=M("coord"),n.textContent=e[r],o.appendChild(n);return o}function Je(e,t){const o=e.dom.elements.board;if(!e.dom.relative&&e.resizable&&"ResizeObserver"in window){new window.ResizeObserver(t).observe(o)}if(e.viewOnly)return;const n=function(e){return t=>{e.draggable.current?De(e):e.drawable.current?ve(e):t.shiftKey||y(t)?e.drawable.enabled&&fe(e,t):e.viewOnly||(e.dropmode.active?function(e,t){if(!e.dropmode.active)return;if(A(e),D(e),e.dropmode.piece){const o=k(t),n=o&&Y(o,e.boardSize,J(e),e.dom.bounds());n&&B(e,"00",n)}e.dom.redraw()}(e,t):Ke(e,t))}}(e);o.addEventListener("touchstart",n,{passive:!1}),o.addEventListener("mousedown",n,{passive:!1}),(e.disableContextMenu||e.drawable.enabled)&&o.addEventListener("contextmenu",(e=>e.preventDefault()))}function et(e,t,o,n){return e.addEventListener(t,o,n),()=>e.removeEventListener(t,o)}function tt(e,t,o){return n=>{n.shiftKey||y(n)?e.drawable.enabled&&o(e,n):e.viewOnly||t(e,n)}}function ot(e){let t=!1;return()=>{t||(t=!0,requestAnimationFrame((()=>{e(),t=!1})))}}function nt(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(o){var n=Object.getOwnPropertyDescriptor(e,o);Object.defineProperty(t,o,n.get?n:{enumerable:!0,get:function(){return e[o]}})})),t}return nt(Object.freeze({__proto__:null,Draughtsground:function(e,t){const o={pieces:te(ee),boardSize:[10,10],orientation:"white",turnColor:"white",coordinates:2,viewOnly:!1,disableContextMenu:!1,resizable:!0,addPieceZIndex:!1,pieceKey:!1,highlight:{lastMove:!0,kingMoves:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{}},premovable:{enabled:!0,showDests:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,centerPiece:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleBlue2:{key:"pb2",color:"#003088",opacity:.65,lineWidth:15},paleBlue3:{key:"pb3",color:"#003088",opacity:.3,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15}},pieces:{baseUrl:"https://playstrategy.org/assets/piece/wide/"},prevSvgHash:""},hold:d()};function n(){let t=o.dom&&o.dom.unbind;const n=o.viewOnly&&!o.drawable.visible,r=Qe(e,o,n),i=function(e){let t;const o=()=>(void 0===t&&(t=e()),t);return o.clear=()=>{t=void 0},o}((()=>r.board.getBoundingClientRect())),a=e=>{ye(o),!e&&r.svg&&Te(o,r.svg)},s=()=>{i.clear(),function(e){if(e.dom.relative)return;const t=J(e),o=m(e.dom.bounds(),e.boardSize);let n=e.dom.elements.board.firstChild;for(;n;)(Me(n)&&!n.cgAnimating||Se(n)||ze(n))&&b(n,o(c(n.cgKey,e.boardSize),t,0)),n=n.nextSibling}(o),r.svg&&Te(o,r.svg)};o.dom={elements:r,bounds:i,redraw:ot(a),redrawNow:a,unbind:t,relative:n},o.drawable.prevSvgHash="",a(!1),Je(o,s),t||(o.dom.unbind=function(e,t){const o=[];if(e.dom.relative||!e.resizable||"ResizeObserver"in window||o.push(et(document.body,"draughtsground.resize",t)),!e.viewOnly){const t=tt(e,Ee,me),n=tt(e,Ae,be);["touchmove","mousemove"].forEach((e=>o.push(et(document,e,t)))),["touchend","mouseup"].forEach((e=>o.push(et(document,e,n))));const r=()=>e.dom.bounds.clear();o.push(et(window,"scroll",r,{passive:!0})),o.push(et(window,"resize",r,{passive:!0}))}return()=>o.forEach((e=>e()))}(o,s)),o.events.insert&&o.events.insert(r)}return oe(o,t||{}),n(),Re(o,n)}})).Draughtsground}();
